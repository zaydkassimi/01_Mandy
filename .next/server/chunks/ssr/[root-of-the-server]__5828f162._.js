module.exports=[6890,(a,b,c)=>{b.exports=a.x("cookie",()=>require("cookie"))},6187,(a,b,c)=>{b.exports=a.x("jsonwebtoken",()=>require("jsonwebtoken"))},5556,a=>{"use strict";var b=a.i(6187);a.i(6890);let c=process.env.JWT_SECRET||"dev-secret";function d(a){try{return b.default.verify(a,c)}catch(a){return null}}a.s(["verifyToken",()=>d])},8972,a=>{"use strict";var b=a.i(9168),c=a.i(7068),d=a.i(2759),e=a.i(3590),f=a.i(7342),g=a.i(8171),h=a.i(6890),i=a.i(5556),j=a.i(7669),k=a.i(7335),l=a.i(9331),m=a.i(8477);function n({user:a}){let[b,c]=(0,j.useState)([]),[d,e]=(0,j.useState)([]),[f,h]=(0,j.useState)(!1),[i,n]=(0,j.useState)(""),[o,p]=(0,j.useState)(()=>{let a=new Date;return a.setDate(1),a}),[q,r]=(0,j.useState)(null);async function s(){let a=await fetch("/api/admin/availability").then(a=>a.json()),b=await fetch("/api/admin/shifts").then(a=>a.json());a.ok&&c(a.availabilities||[]),b.ok&&e(b.shifts||[])}(0,j.useEffect)(()=>{s()},[]);let{showToast:t}=(0,j.useContext)(m.ToastContext);async function u(a,b){if(!b)return alert("Choose a shift");h(!0);let c=await fetch("/api/admin/assign_shift",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({shiftId:b,email:a.email})}),d=await c.json();h(!1),d.ok?(t(`Assigned ${a.email} to shift`,{type:"info"}),s()):t("Assignment failed",{type:"error"})}let v=b.reduce((a,b)=>(a[b.date]=a[b.date]||[],a[b.date].push(b),a),{});return(0,g.jsxs)("main",{children:[(0,g.jsx)("h1",{children:"Staff Availability"}),(0,g.jsx)("p",{className:"small",children:"View staff availability and allocate shifts."}),i&&(0,g.jsx)("div",{className:"mt-3 p-3 rounded-md bg-green-50 text-green-800",children:i}),(0,g.jsxs)("div",{className:"mt-4",children:[(0,g.jsxs)("div",{className:"flex items-center gap-4 mb-4",children:[(0,g.jsx)(l.default,{onClick:function(){let a=new Date(o);a.setMonth(a.getMonth()-1),p(a),r(null)},variant:"ghost",children:"Prev"}),(0,g.jsx)("div",{className:"font-semibold",children:o.toLocaleString(void 0,{month:"long",year:"numeric"})}),(0,g.jsx)(l.default,{onClick:function(){let a=new Date(o);a.setMonth(a.getMonth()+1),p(a),r(null)},variant:"ghost",children:"Next"})]}),(0,g.jsxs)("div",{className:"grid grid-cols-7 gap-3",children:[["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map(a=>(0,g.jsx)("div",{className:"text-sm text-gray-500",children:a},a)),Array.from({length:new Date(o.getFullYear(),o.getMonth(),1).getDay()}).map((a,b)=>(0,g.jsx)("div",{},"b"+b)),Array.from({length:new Date(o.getFullYear(),o.getMonth()+1,0).getDate()}).map((a,b)=>{var c;let e,f,h,i=b+1,j=(e=(c=new Date(o.getFullYear(),o.getMonth(),i)).getFullYear(),f=String(c.getMonth()+1).padStart(2,"0"),h=String(c.getDate()).padStart(2,"0"),`${e}-${f}-${h}`),k=v[j]||[];return d.filter(a=>a.date===j),(0,g.jsxs)("div",{className:"p-3 border rounded-md bg-white",children:[(0,g.jsxs)("div",{className:"flex justify-between items-start",children:[(0,g.jsx)("div",{className:"text-sm font-medium",children:i}),(0,g.jsxs)("div",{className:"text-xs text-gray-500",children:[k.length," avail"]})]}),(0,g.jsxs)("div",{className:"mt-2 text-sm space-y-1",children:[k.slice(0,3).map(a=>(0,g.jsx)("div",{className:"flex items-center justify-between",children:(0,g.jsx)("div",{children:a.email})},a.email)),k.length>3&&(0,g.jsxs)("div",{className:"text-xs text-gray-400",children:["+",k.length-3," more"]})]}),(0,g.jsx)("div",{className:"mt-3",children:(0,g.jsx)(l.default,{onClick:()=>r(j),variant:"secondary",children:"Manage"})})]},j)})]}),q&&(0,g.jsxs)(k.default,{className:"mt-6",children:[(0,g.jsxs)("div",{className:"flex items-center justify-between",children:[(0,g.jsxs)("div",{children:[(0,g.jsx)("div",{className:"text-sm text-gray-500",children:"Date"}),(0,g.jsx)("div",{className:"font-semibold",children:q})]}),(0,g.jsx)("div",{children:(0,g.jsx)(l.default,{onClick:()=>{r(null)},children:"Close"})})]}),(0,g.jsxs)("div",{className:"mt-4",children:[(0,g.jsx)("div",{className:"text-sm text-gray-600 mb-2",children:"Available staff"}),(v[q]||[]).map(a=>(0,g.jsxs)("div",{className:"flex items-center justify-between gap-3 mb-2",children:[(0,g.jsx)("div",{children:a.email}),(0,g.jsxs)("div",{className:"flex items-center gap-2",children:[(0,g.jsxs)("select",{defaultValue:"",className:"border px-2 py-1 rounded-md",id:`shift-select-${a.email}`,children:[(0,g.jsx)("option",{value:"",children:"Select shift"}),d.filter(a=>a.date===q).map(a=>(0,g.jsxs)("option",{value:a.id,children:[a.title," (",a.start||"â€”",")"]},a.id))]}),(0,g.jsx)(l.default,{onClick:()=>{let b=document.getElementById(`shift-select-${a.email}`);u(a,b?.value)},disabled:f,children:"Assign"})]})]},a.email))]})]})]})]})}function o({req:a}){let b=(a.headers.cookie?(0,h.parse)(a.headers.cookie||""):{}).token,c=b?(0,i.verifyToken)(b):null;return c&&"admin"===c.role?{props:{user:c}}:{redirect:{destination:"/",permanent:!1}}}a.s(["default",()=>n,"getServerSideProps",()=>o],1646);var p=a.i(1646),q=a.i(9193);let r=(0,d.hoist)(p,"default"),s=(0,d.hoist)(p,"getStaticProps"),t=(0,d.hoist)(p,"getStaticPaths"),u=(0,d.hoist)(p,"getServerSideProps"),v=(0,d.hoist)(p,"config"),w=(0,d.hoist)(p,"reportWebVitals"),x=(0,d.hoist)(p,"unstable_getStaticProps"),y=(0,d.hoist)(p,"unstable_getStaticPaths"),z=(0,d.hoist)(p,"unstable_getStaticParams"),A=(0,d.hoist)(p,"unstable_getServerProps"),B=(0,d.hoist)(p,"unstable_getServerSideProps"),C=new b.PagesRouteModule({definition:{kind:c.RouteKind.PAGES,page:"/admin/availability",pathname:"/admin/availability",bundlePath:"",filename:""},distDir:".next",relativeProjectDir:"",components:{App:f.default,Document:e.default},userland:p}),D=(0,q.getHandler)({srcPage:"/admin/availability",config:v,userland:p,routeModule:C,getStaticPaths:t,getStaticProps:s,getServerSideProps:u});a.s(["config",0,v,"default",0,r,"getServerSideProps",0,u,"getStaticPaths",0,t,"getStaticProps",0,s,"handler",0,D,"reportWebVitals",0,w,"routeModule",0,C,"unstable_getServerProps",0,A,"unstable_getServerSideProps",0,B,"unstable_getStaticParams",0,z,"unstable_getStaticPaths",0,y,"unstable_getStaticProps",0,x],8972)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__5828f162._.js.map