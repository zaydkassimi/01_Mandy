module.exports=[6890,(a,b,c)=>{b.exports=a.x("cookie",()=>require("cookie"))},6187,(a,b,c)=>{b.exports=a.x("jsonwebtoken",()=>require("jsonwebtoken"))},5556,a=>{"use strict";var b=a.i(6187);a.i(6890);let c=process.env.JWT_SECRET||"dev-secret";function d(a){try{return b.default.verify(a,c)}catch(a){return null}}a.s(["verifyToken",()=>d])},7301,a=>{"use strict";var b=a.i(9168),c=a.i(7068),d=a.i(2759),e=a.i(3590),f=a.i(7342),g=a.i(8171),h=a.i(6890),i=a.i(5556),j=a.i(7669),k=a.i(8477);function l({user:a}){let[b,c]=(0,j.useState)([]),[d,e]=(0,j.useState)(""),[f,h]=(0,j.useState)(""),[i,l]=(0,j.useState)("");async function m(){await fetch("/api/admin/expenses",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({date:d,amount:f,note:i})}),e(""),h(""),l("");let a=await fetch("/api/admin/expenses"),b=await a.json();b.ok&&c(b.expenses||[])}(0,j.useEffect)(()=>{fetch("/api/admin/expenses").then(a=>a.json()).then(a=>{a.ok&&c(a.expenses||[])})},[]);let[n,o]=(0,j.useState)("");async function p(a,b){o(""),await fetch("/api/admin/expenses/approve",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:a,approved:b})}),c(c=>c.map(c=>c.id===a?{...c,approved:b}:c));let d=b?"Expense approved":"Expense approval revoked";o(d),q(d,{type:"info"}),setTimeout(()=>o(""),3500)}let{showToast:q}=(0,j.useContext)(k.ToastContext);return(0,g.jsxs)("main",{children:[(0,g.jsx)("h1",{children:"Expenses"}),(0,g.jsxs)("div",{className:"card",children:[(0,g.jsxs)("div",{children:[(0,g.jsx)("input",{type:"date",value:d,onChange:a=>e(a.target.value)})," ",(0,g.jsx)("input",{placeholder:"amount",value:f,onChange:a=>h(a.target.value)}),(0,g.jsx)("input",{placeholder:"note",value:i,onChange:a=>l(a.target.value),style:{marginLeft:8}}),(0,g.jsx)("button",{className:"btn",onClick:m,style:{marginLeft:8},children:"Add"})]}),(0,g.jsxs)("table",{style:{width:"100%",marginTop:12},children:[(0,g.jsx)("thead",{children:(0,g.jsxs)("tr",{children:[(0,g.jsx)("th",{children:"Date"}),(0,g.jsx)("th",{children:"Amount (GBP)"}),(0,g.jsx)("th",{children:"Note"}),(0,g.jsx)("th",{children:"By"}),(0,g.jsx)("th",{children:"Approved"})]})}),(0,g.jsx)("tbody",{children:b.map(a=>(0,g.jsxs)("tr",{children:[(0,g.jsx)("td",{style:{padding:8},children:a.date}),(0,g.jsx)("td",{style:{padding:8},children:"Â£"+Number(a.amount||0).toFixed(2)}),(0,g.jsx)("td",{style:{padding:8},children:a.note}),(0,g.jsx)("td",{style:{padding:8},children:a.email}),(0,g.jsxs)("td",{style:{padding:8},children:[a.approved?"Yes":"No",(0,g.jsxs)("div",{style:{marginTop:6},children:[!a.approved&&(0,g.jsx)("button",{className:"btn",onClick:()=>p(a.id,!0),children:"Approve"}),a.approved&&(0,g.jsx)("button",{className:"btn secondary",onClick:()=>p(a.id,!1),children:"Revoke"})]})]})]},a.id))})]}),n&&(0,g.jsx)("div",{className:"mt-3 p-3 rounded-md bg-green-50 text-green-800",children:n})]})]})}function m({req:a}){let b=(a.headers.cookie?(0,h.parse)(a.headers.cookie||""):{}).token,c=b?(0,i.verifyToken)(b):null;return c&&"admin"===c.role?{props:{user:c}}:{redirect:{destination:"/",permanent:!1}}}a.s(["default",()=>l,"getServerSideProps",()=>m],2555);var n=a.i(2555),o=a.i(9193);let p=(0,d.hoist)(n,"default"),q=(0,d.hoist)(n,"getStaticProps"),r=(0,d.hoist)(n,"getStaticPaths"),s=(0,d.hoist)(n,"getServerSideProps"),t=(0,d.hoist)(n,"config"),u=(0,d.hoist)(n,"reportWebVitals"),v=(0,d.hoist)(n,"unstable_getStaticProps"),w=(0,d.hoist)(n,"unstable_getStaticPaths"),x=(0,d.hoist)(n,"unstable_getStaticParams"),y=(0,d.hoist)(n,"unstable_getServerProps"),z=(0,d.hoist)(n,"unstable_getServerSideProps"),A=new b.PagesRouteModule({definition:{kind:c.RouteKind.PAGES,page:"/admin/expenses",pathname:"/admin/expenses",bundlePath:"",filename:""},distDir:".next",relativeProjectDir:"",components:{App:f.default,Document:e.default},userland:n}),B=(0,o.getHandler)({srcPage:"/admin/expenses",config:t,userland:n,routeModule:A,getStaticPaths:r,getStaticProps:q,getServerSideProps:s});a.s(["config",0,t,"default",0,p,"getServerSideProps",0,s,"getStaticPaths",0,r,"getStaticProps",0,q,"handler",0,B,"reportWebVitals",0,u,"routeModule",0,A,"unstable_getServerProps",0,y,"unstable_getServerSideProps",0,z,"unstable_getStaticParams",0,x,"unstable_getStaticPaths",0,w,"unstable_getStaticProps",0,v],7301)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__8331bb3d._.js.map