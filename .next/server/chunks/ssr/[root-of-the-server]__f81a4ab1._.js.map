{"version":3,"sources":["../../../../lib/auth.js","../../../../pages/admin/export.js","../../../../node_modules/next/dist/esm/build/templates/pages.js"],"sourcesContent":["import jwt from \"jsonwebtoken\";\r\nimport { serialize } from \"cookie\";\r\n\r\nconst JWT_SECRET = process.env.JWT_SECRET || \"dev-secret\";\r\n\r\nexport function signToken(payload) {\r\n  return jwt.sign(payload, JWT_SECRET, { expiresIn: \"8h\" });\r\n}\r\n\r\nexport function verifyToken(token) {\r\n  try {\r\n    return jwt.verify(token, JWT_SECRET);\r\n  } catch (e) {\r\n    return null;\r\n  }\r\n}\r\n\r\nexport function setTokenCookie(res, token) {\r\n  const cookie = serialize(\"token\", token, {\r\n    httpOnly: true,\r\n    path: \"/\",\r\n    maxAge: 60 * 60 * 8\r\n  });\r\n  res.setHeader(\"Set-Cookie\", cookie);\r\n}\r\n\r\nexport function clearTokenCookie(res) {\r\n  const cookie = serialize(\"token\", \"\", {\r\n    httpOnly: true,\r\n    path: \"/\",\r\n    maxAge: 0\r\n  });\r\n  res.setHeader(\"Set-Cookie\", cookie);\r\n}\r\n\r\n\r\n","import { parse } from \"cookie\";\r\nimport { verifyToken } from \"../../lib/auth\";\r\n\r\nexport default function AdminExport({ user }) {\r\n  function download(type, fmt = \"csv\") {\r\n    if (fmt === \"csv\") window.location.href = `/api/export?type=${type}`;\r\n    if (fmt === \"xlsx\") window.location.href = `/api/export_xlsx?type=${type}`;\r\n    if (fmt === \"docx\") window.location.href = `/api/export_docx?type=${type}`;\r\n  }\r\n\r\n  const tiles = [\r\n    { key: \"users\", title: \"Users\", desc: \"All staff accounts and roles\", emoji: \"ðŸ‘¥\" },\r\n    { key: \"attendances\", title: \"Attendance\", desc: \"Check-in/out records with location & photo\", emoji: \"ðŸ•˜\" },\r\n    { key: \"shifts\", title: \"Shifts\", desc: \"Scheduled shifts and times\", emoji: \"ðŸ“…\" },\r\n    { key: \"expenses\", title: \"Expenses\", desc: \"Recorded expenses (GBP)\", emoji: \"ðŸ’·\" }\r\n  ];\r\n\r\n  return (\r\n    <main>\r\n      <div style={{ display: \"flex\", alignItems: \"center\", justifyContent: \"space-between\", gap: 12 }}>\r\n        <h1>Export Data</h1>\r\n        <div className=\"small\">Signed in as <strong>{user.email}</strong></div>\r\n      </div>\r\n\r\n      <div className=\"card\" style={{ marginTop: 12 }}>\r\n        <p className=\"small\">Select the dataset and format you want to export. CSV is good for spreadsheets, XLSX for richer Excel use, DOCX for readable reports.</p>\r\n\r\n        <div className=\"export-grid\" style={{ marginTop: 18 }}>\r\n          {tiles.map((t) => (\r\n            <div className=\"export-tile card\" key={t.key}>\r\n              <div style={{ display: \"flex\", alignItems: \"center\", gap: 12 }}>\r\n                <div style={{ fontSize: 28 }}>{t.emoji}</div>\r\n                <div>\r\n                  <div style={{ fontWeight: 700 }}>{t.title}</div>\r\n                  <div className=\"small\">{t.desc}</div>\r\n                </div>\r\n              </div>\r\n\r\n              <div style={{ marginTop: 12, display: \"flex\", gap: 8 }}>\r\n                <button className=\"btn\" onClick={() => download(t.key, \"csv\")}>CSV</button>\r\n                <button className=\"btn secondary\" onClick={() => download(t.key, \"xlsx\")}>XLSX</button>\r\n                <button className=\"btn\" onClick={() => download(t.key, \"docx\")}>DOCX</button>\r\n              </div>\r\n            </div>\r\n          ))}\r\n        </div>\r\n      </div>\r\n    </main>\r\n  );\r\n}\r\n\r\nexport function getServerSideProps({ req }) {\r\n  const cookies = req.headers.cookie ? parse(req.headers.cookie || \"\") : {};\r\n  const token = cookies.token;\r\n  const user = token ? verifyToken(token) : null;\r\n  if (!user || user.role !== \"admin\") {\r\n    return { redirect: { destination: \"/\", permanent: false } };\r\n  }\r\n  return { props: { user } };\r\n}\r\n\r\n\r\n","import { PagesRouteModule } from \"next/dist/esm/server/route-modules/pages/module.compiled\";\nimport { RouteKind } from \"next/dist/esm/server/route-kind\";\nimport { hoist } from \"next/dist/esm/build/templates/helpers\";\n// Import the app and document modules.\nimport * as document from \"INNER_DOCUMENT\";\nimport * as app from \"INNER_APP\";\n// Import the userland code.\nimport * as userland from \"INNER_PAGE\";\nimport { getHandler } from \"next/dist/esm/server/route-modules/pages/pages-handler\";\n// Re-export the component (should be the default export).\nexport default hoist(userland, 'default');\n// Re-export methods.\nexport const getStaticProps = hoist(userland, 'getStaticProps');\nexport const getStaticPaths = hoist(userland, 'getStaticPaths');\nexport const getServerSideProps = hoist(userland, 'getServerSideProps');\nexport const config = hoist(userland, 'config');\nexport const reportWebVitals = hoist(userland, 'reportWebVitals');\n// Re-export legacy methods.\nexport const unstable_getStaticProps = hoist(userland, 'unstable_getStaticProps');\nexport const unstable_getStaticPaths = hoist(userland, 'unstable_getStaticPaths');\nexport const unstable_getStaticParams = hoist(userland, 'unstable_getStaticParams');\nexport const unstable_getServerProps = hoist(userland, 'unstable_getServerProps');\nexport const unstable_getServerSideProps = hoist(userland, 'unstable_getServerSideProps');\n// Create and export the route module that will be consumed.\nexport const routeModule = new PagesRouteModule({\n    definition: {\n        kind: RouteKind.PAGES,\n        page: \"/admin/export\",\n        pathname: \"/admin/export\",\n        // The following aren't used in production.\n        bundlePath: '',\n        filename: ''\n    },\n    distDir: process.env.__NEXT_RELATIVE_DIST_DIR || '',\n    relativeProjectDir: process.env.__NEXT_RELATIVE_PROJECT_DIR || '',\n    components: {\n        // default export might not exist when optimized for data only\n        App: app.default,\n        Document: document.default\n    },\n    userland\n});\nexport const handler = getHandler({\n    srcPage: \"/admin/export\",\n    config,\n    userland,\n    routeModule,\n    getStaticPaths,\n    getStaticProps,\n    getServerSideProps\n});\n\n//# sourceMappingURL=pages.js.map\n"],"names":[],"mappings":"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","ignoreList":[2]}