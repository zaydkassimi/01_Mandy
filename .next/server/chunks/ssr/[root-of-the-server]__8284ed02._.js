module.exports=[6890,(a,b,c)=>{b.exports=a.x("cookie",()=>require("cookie"))},6187,(a,b,c)=>{b.exports=a.x("jsonwebtoken",()=>require("jsonwebtoken"))},5556,a=>{"use strict";var b=a.i(6187);a.i(6890);let c=process.env.JWT_SECRET||"dev-secret";function d(a){try{return b.default.verify(a,c)}catch(a){return null}}a.s(["verifyToken",()=>d])},3264,a=>{"use strict";var b=a.i(9168),c=a.i(7068),d=a.i(2759),e=a.i(3590),f=a.i(7342),g=a.i(8171),h=a.i(7669),i=a.i(6890),j=a.i(5556);function k({user:a}){let b=(0,h.useRef)(),c=(0,h.useRef)(),[d,e]=(0,h.useState)(null),[f,i]=(0,h.useState)("");async function j(a){let d,e;i("Preparing...");let f=(d=b.current,e=c.current,d&&e?(e.width=d.videoWidth||640,e.height=d.videoHeight||480,e.getContext("2d").drawImage(d,0,0,e.width,e.height),e.toDataURL("image/jpeg",.8)):null);if(!f)return void i("Unable to capture photo. Make sure camera is allowed and visible.");let g=await new Promise(a=>{if(!navigator.geolocation)return a({lat:null,lng:null});navigator.geolocation.getCurrentPosition(b=>a({lat:b.coords.latitude,lng:b.coords.longitude}),()=>a({lat:null,lng:null}),{enableHighAccuracy:!0,timeout:5e3,maximumAge:0})}),h=new Date,j=h.getHours()>9||9===h.getHours()&&h.getMinutes()>15,k=!1;j&&(k=confirm("It looks like you are late. Do you want to request admin approval?")),i("Uploading...");let l=await fetch("/api/attendance",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:a,photo:f,lat:g.lat,lng:g.lng,clientTimestamp:h.toISOString(),lateRequested:k})}),m=await l.json();m.ok?i(`Success: ${a} recorded at ${new Date(m.attendance.timestamp).toLocaleString()}`):i("Error: "+(m.message||"Upload failed"))}return(0,h.useEffect)(()=>{let a=!0;return async function(){try{let c=await navigator.mediaDevices.getUserMedia({video:{facingMode:{ideal:"environment"}},audio:!1});if(!a)return void c.getTracks().forEach(a=>a.stop());e(c),b.current&&(b.current.srcObject=c)}catch(a){i("Camera access denied or unavailable: "+a.message)}}(),()=>{a=!1,d&&d.getTracks().forEach(a=>a.stop())}},[]),(0,g.jsxs)("main",{children:[(0,g.jsx)("h1",{children:"Check In / Check Out"}),(0,g.jsxs)("div",{className:"card",children:[(0,g.jsxs)("p",{children:["Signed in as ",(0,g.jsx)("strong",{children:a.email})]}),(0,g.jsxs)("div",{children:[(0,g.jsx)("video",{ref:b,autoPlay:!0,playsInline:!0,style:{width:"100%",maxWidth:480,borderRadius:8,background:"#000"}}),(0,g.jsx)("canvas",{ref:c,style:{display:"none"}})]}),(0,g.jsxs)("div",{style:{marginTop:12},children:[(0,g.jsx)("button",{className:"btn",onClick:()=>j("checkin"),children:"Check In"}),(0,g.jsx)("button",{className:"btn secondary",onClick:()=>j("checkout"),style:{marginLeft:8},children:"Check Out"})]}),(0,g.jsx)("div",{style:{marginTop:12},children:f})]})]})}function l({req:a}){let b=(a.headers.cookie?(0,i.parse)(a.headers.cookie||""):{}).token,c=b?(0,j.verifyToken)(b):null;return c?"admin"===c.role?{redirect:{destination:"/admin",permanent:!1}}:{props:{user:c}}:{redirect:{destination:"/login",permanent:!1}}}a.s(["default",()=>k,"getServerSideProps",()=>l],5611);var m=a.i(5611),n=a.i(9193);let o=(0,d.hoist)(m,"default"),p=(0,d.hoist)(m,"getStaticProps"),q=(0,d.hoist)(m,"getStaticPaths"),r=(0,d.hoist)(m,"getServerSideProps"),s=(0,d.hoist)(m,"config"),t=(0,d.hoist)(m,"reportWebVitals"),u=(0,d.hoist)(m,"unstable_getStaticProps"),v=(0,d.hoist)(m,"unstable_getStaticPaths"),w=(0,d.hoist)(m,"unstable_getStaticParams"),x=(0,d.hoist)(m,"unstable_getServerProps"),y=(0,d.hoist)(m,"unstable_getServerSideProps"),z=new b.PagesRouteModule({definition:{kind:c.RouteKind.PAGES,page:"/checkin",pathname:"/checkin",bundlePath:"",filename:""},distDir:".next",relativeProjectDir:"",components:{App:f.default,Document:e.default},userland:m}),A=(0,n.getHandler)({srcPage:"/checkin",config:s,userland:m,routeModule:z,getStaticPaths:q,getStaticProps:p,getServerSideProps:r});a.s(["config",0,s,"default",0,o,"getServerSideProps",0,r,"getStaticPaths",0,q,"getStaticProps",0,p,"handler",0,A,"reportWebVitals",0,t,"routeModule",0,z,"unstable_getServerProps",0,x,"unstable_getServerSideProps",0,y,"unstable_getStaticParams",0,w,"unstable_getStaticPaths",0,v,"unstable_getStaticProps",0,u],3264)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__8284ed02._.js.map