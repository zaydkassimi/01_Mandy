module.exports=[6890,(a,b,c)=>{b.exports=a.x("cookie",()=>require("cookie"))},6187,(a,b,c)=>{b.exports=a.x("jsonwebtoken",()=>require("jsonwebtoken"))},5556,a=>{"use strict";var b=a.i(6187);a.i(6890);let c=process.env.JWT_SECRET||"dev-secret";function d(a){try{return b.default.verify(a,c)}catch(a){return null}}a.s(["verifyToken",()=>d])},7057,a=>{"use strict";var b=a.i(2734);let c=a.i(4747).default.join(process.cwd(),"data","db.json");async function d(){return JSON.parse(await b.default.promises.readFile(c,"utf-8"))}async function e(){let a=await d();return a.attendances||(a.attendances=[]),a.attendances}async function f(){return(await d()).users||[]}async function g(){let a=await d();return a.shifts=a.shifts||[],a.shifts}async function h(){let a=await d();return a.expenses=a.expenses||[],a.expenses}a.s(["getAllAttendances",()=>e,"listExpenses",()=>h,"listShifts",()=>g,"listUsers",()=>f])},5250,a=>{"use strict";var b=a.i(9168),c=a.i(7068),d=a.i(2759),e=a.i(3590),f=a.i(7342),g=a.i(8171),h=a.i(6890),i=a.i(5556),j=a.i(7057),k=a.i(7335),l=a.i(9331);function m({user:b,shifts:c,attendances:d,users:e}){let f=(e||[]).map(a=>{let b=(c||[]).filter(b=>(b.assigned||[]).includes(a.email)).length,e=(d||[]).filter(b=>b.email===a.email).length;return{email:a.email,assignedCount:b,attendCount:e}});return(0,g.jsxs)("main",{children:[(0,g.jsx)("h1",{children:"Reports"}),(0,g.jsx)("p",{className:"small",children:"Overview of assigned shifts and attendance per staff."}),(0,g.jsxs)("div",{className:"flex gap-3 mt-4",children:[(0,g.jsx)("a",{className:"nav-link",href:"/api/export?type=shifts",children:"Download shifts (CSV)"}),(0,g.jsx)("a",{className:"nav-link",href:"/api/export_xlsx?type=shifts",children:"Download shifts (XLSX)"}),(0,g.jsx)(l.default,{onClick:async()=>{let a=new Blob([["email,assignedCount,attendCount",...e.map(a=>{let b=(c||[]).filter(b=>(b.assigned||[]).includes(a.email)).length,e=(d||[]).filter(b=>b.email===a.email).length;return{email:a.email,assignedCount:b,attendCount:e}}).map(a=>`${a.email},${a.assignedCount},${a.attendCount}`)].join("\n")],{type:"text/csv;charset=utf-8;"}),b=URL.createObjectURL(a),f=document.createElement("a");f.href=b,f.download="staff-summary.csv",document.body.appendChild(f),f.click(),f.remove(),URL.revokeObjectURL(b)},children:"Download staff summary (CSV)"}),(0,g.jsx)(l.default,{onClick:async()=>{let b=await a.A(2018),f=e.map(a=>{let b=(c||[]).filter(b=>(b.assigned||[]).includes(a.email)).length,e=(d||[]).filter(b=>b.email===a.email).length;return{email:a.email,assignedCount:b,attendCount:e}}),g=b.utils.json_to_sheet(f),h=b.utils.book_new();b.utils.book_append_sheet(h,g,"staff");let i=new Blob([b.write(h,{bookType:"xlsx",type:"array"})],{type:"application/octet-stream"}),j=URL.createObjectURL(i),k=document.createElement("a");k.href=j,k.download="staff-summary.xlsx",document.body.appendChild(k),k.click(),k.remove(),URL.revokeObjectURL(j)},variant:"secondary",children:"Download staff summary (XLSX)"})]}),(0,g.jsxs)("div",{className:"grid gap-4 mt-4",children:[(0,g.jsxs)(k.default,{children:[(0,g.jsx)("h3",{className:"font-semibold",children:"Shifts (with assigned staff)"}),(0,g.jsxs)("table",{style:{width:"100%",marginTop:12},children:[(0,g.jsx)("thead",{children:(0,g.jsxs)("tr",{children:[(0,g.jsx)("th",{children:"Title"}),(0,g.jsx)("th",{children:"Date"}),(0,g.jsx)("th",{children:"Time"}),(0,g.jsx)("th",{children:"Assigned"})]})}),(0,g.jsx)("tbody",{children:(c||[]).map(a=>(0,g.jsxs)("tr",{children:[(0,g.jsx)("td",{style:{padding:8},children:a.title}),(0,g.jsx)("td",{style:{padding:8},children:a.date}),(0,g.jsxs)("td",{style:{padding:8},children:[a.start||"-"," - ",a.end||"-"]}),(0,g.jsx)("td",{style:{padding:8},children:(a.assigned||[]).join(", ")||"-"})]},a.id))})]})]}),(0,g.jsxs)(k.default,{children:[(0,g.jsx)("h3",{className:"font-semibold",children:"Staff summary"}),(0,g.jsxs)("table",{style:{width:"100%",marginTop:12},children:[(0,g.jsx)("thead",{children:(0,g.jsxs)("tr",{children:[(0,g.jsx)("th",{children:"Staff"}),(0,g.jsx)("th",{children:"Assigned shifts"}),(0,g.jsx)("th",{children:"Attendance records"})]})}),(0,g.jsx)("tbody",{children:f.map(a=>(0,g.jsxs)("tr",{children:[(0,g.jsx)("td",{style:{padding:8},children:a.email}),(0,g.jsx)("td",{style:{padding:8},children:a.assignedCount}),(0,g.jsx)("td",{style:{padding:8},children:a.attendCount})]},a.email))})]})]})]})]})}async function n({req:a}){let b=(a.headers.cookie?(0,h.parse)(a.headers.cookie||""):{}).token,c=b?(0,i.verifyToken)(b):null;return c&&"admin"===c.role?{props:{user:c,shifts:await (0,j.listShifts)(),attendances:await (0,j.getAllAttendances)(),users:await (0,j.listUsers)()}}:{redirect:{destination:"/",permanent:!1}}}a.i(7669),a.s(["default",()=>m,"getServerSideProps",()=>n],8217);var o=a.i(8217),p=a.i(9193);let q=(0,d.hoist)(o,"default"),r=(0,d.hoist)(o,"getStaticProps"),s=(0,d.hoist)(o,"getStaticPaths"),t=(0,d.hoist)(o,"getServerSideProps"),u=(0,d.hoist)(o,"config"),v=(0,d.hoist)(o,"reportWebVitals"),w=(0,d.hoist)(o,"unstable_getStaticProps"),x=(0,d.hoist)(o,"unstable_getStaticPaths"),y=(0,d.hoist)(o,"unstable_getStaticParams"),z=(0,d.hoist)(o,"unstable_getServerProps"),A=(0,d.hoist)(o,"unstable_getServerSideProps"),B=new b.PagesRouteModule({definition:{kind:c.RouteKind.PAGES,page:"/admin/reports",pathname:"/admin/reports",bundlePath:"",filename:""},distDir:".next",relativeProjectDir:"",components:{App:f.default,Document:e.default},userland:o}),C=(0,p.getHandler)({srcPage:"/admin/reports",config:u,userland:o,routeModule:B,getStaticPaths:s,getStaticProps:r,getServerSideProps:t});a.s(["config",0,u,"default",0,q,"getServerSideProps",0,t,"getStaticPaths",0,s,"getStaticProps",0,r,"handler",0,C,"reportWebVitals",0,v,"routeModule",0,B,"unstable_getServerProps",0,z,"unstable_getServerSideProps",0,A,"unstable_getStaticParams",0,y,"unstable_getStaticPaths",0,x,"unstable_getStaticProps",0,w],5250)},2018,a=>{a.v(b=>Promise.all(["server/chunks/ssr/[externals]_xlsx_6d5f793a._.js"].map(b=>a.l(b))).then(()=>b(6969)))}];

//# sourceMappingURL=%5Broot-of-the-server%5D__85d8b173._.js.map