module.exports=[2734,(e,t,a)=>{t.exports=e.x("fs",()=>require("fs"))},406,(e,t,a)=>{t.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},4747,(e,t,a)=>{t.exports=e.x("path",()=>require("path"))},6890,(e,t,a)=>{t.exports=e.x("cookie",()=>require("cookie"))},6187,(e,t,a)=>{t.exports=e.x("jsonwebtoken",()=>require("jsonwebtoken"))},3064,e=>{"use strict";var t=e.i(6187),a=e.i(6890);let i=process.env.JWT_SECRET||"dev-secret";function n(e){return t.default.sign(e,i,{expiresIn:"8h"})}function s(e){try{return t.default.verify(e,i)}catch(e){return null}}function r(e,t){let i=(0,a.serialize)("token",t,{httpOnly:!0,path:"/",maxAge:28800});e.setHeader("Set-Cookie",i)}function l(e){let t=(0,a.serialize)("token","",{httpOnly:!0,path:"/",maxAge:0});e.setHeader("Set-Cookie",t)}e.s(["clearTokenCookie",()=>l,"setTokenCookie",()=>r,"signToken",()=>n,"verifyToken",()=>s])},2692,e=>{"use strict";var t=e.i(2734);let a=e.i(4747).default.join(process.cwd(),"data","db.json");async function i(){return JSON.parse(await t.default.promises.readFile(a,"utf-8"))}async function n(e){await t.default.promises.writeFile(a,JSON.stringify(e,null,2),"utf-8")}async function s(e){return(await i()).users.find(t=>t.email===e)}async function r(e){let t=await i();return t.users.push(e),await n(t),e}async function l(e){let t=await i();return t.availabilities||(t.availabilities=[]),t.availabilities.filter(t=>t.email===e)}async function o(e,t,a){let s=await i();return s.availabilities||(s.availabilities=[]),s.availabilities=s.availabilities.filter(a=>a.email!==e||a.date!==t),a&&s.availabilities.push({email:e,date:t,status:a}),await n(s),!0}async function d(e){let t=await i();return t.attendances||(t.attendances=[]),t.attendances.push(e),await n(t),e}async function c(e){let t=await i();return t.attendances||(t.attendances=[]),t.attendances.filter(t=>t.email===e)}async function u(){let e=await i();return e.attendances||(e.attendances=[]),e.attendances}async function p(e,t){let a=await i();a.attendances||(a.attendances=[]);let s=a.attendances.find(t=>t.id===e);return!!s&&(s.approved=!!t,await n(a),!0)}async function f(){return(await i()).users||[]}async function w(e){let t=await i();return t.users=(t.users||[]).filter(t=>t.email!==e),await n(t),!0}async function h(){let e=await i();return e.shifts=e.shifts||[],e.shifts}async function x(e){let t=await i();return t.shifts=t.shifts||[],t.shifts.push(e),await n(t),e}async function y(e){let t=await i();return t.shifts=(t.shifts||[]).filter(t=>t.id!==e),await n(t),!0}async function m(){let e=await i();return e.expenses=e.expenses||[],e.expenses}async function g(e){let t=await i();return t.expenses=t.expenses||[],t.expenses.push(e),await n(t),e}async function v(){let e=await i();return e.settings=e.settings||{siteTitle:"Staff Scheduler",logo:null},e.settings}async function b(e){let t=await i();return t.settings=Object.assign(t.settings||{},e),await n(t),t.settings}async function S(){let e=await i();return e.availabilities=e.availabilities||[],e.availabilities}async function k(e,t){let a=await i();a.shifts=a.shifts||[];let s=a.shifts.find(t=>t.id===e);return!!s&&(s.assigned=s.assigned||[],s.assigned.includes(t)||s.assigned.push(t),await n(a),!0)}async function A(e,t){let a=await i();a.expenses=a.expenses||[];let s=a.expenses.find(t=>t.id===e);return!!s&&(s.approved=!!t,await n(a),!0)}e.s(["addAttendance",()=>d,"addExpense",()=>g,"addShift",()=>x,"addUser",()=>r,"assignUserToShift",()=>k,"deleteShiftById",()=>y,"deleteUserByEmail",()=>w,"findUserByEmail",()=>s,"getAllAttendances",()=>u,"getAllAvailabilities",()=>S,"getAttendanceByEmail",()=>c,"getAvailabilitiesByEmail",()=>l,"getSettings",()=>v,"listExpenses",()=>m,"listShifts",()=>h,"listUsers",()=>f,"setAttendanceApproved",()=>p,"setAvailability",()=>o,"setExpenseApproved",()=>A,"setSettings",()=>b])},6505,e=>e.a(async(t,a)=>{try{let t=await e.y("docx");e.n(t),a()}catch(e){a(e)}},!0),4035,e=>e.a(async(t,a)=>{try{var i=e.i(6890),n=e.i(3064),s=e.i(2692),r=e.i(6505),l=t([r]);async function o(e,t){let a=new r.Document;a.addSection({children:[new r.Paragraph({children:[new r.TextRun({text:"Export",bold:!0})]}),...e.map(e=>{let a=t.map(t=>`${t}: ${e[t]??""}`).join(" | ");return new r.Paragraph(a)})]});let i=new r.Packer;return await i.toBuffer(a)}async function d(e,t){let a=(e.headers.cookie?(0,i.parse)(e.headers.cookie||""):{}).token,r=a?(0,n.verifyToken)(a):null;if(!r||"admin"!==r.role)return t.status(403).json({ok:!1,message:"admin only"});let l=e.query.type||"attendances",d=[],c=[],u="export.docx";if("users"===l)d=await (0,s.listUsers)(),c=["email","role"],u="users.docx";else if("attendances"===l)d=await (0,s.getAllAttendances)(),c=["id","email","action","timestamp","lat","lng","approved"],u="attendances.docx";else if("shifts"===l)d=await (0,s.listShifts)(),c=["id","title","date","start","end","capacity"],u="shifts.docx";else{if("expenses"!==l)return t.status(400).json({ok:!1,message:"unknown type"});d=await (0,s.listExpenses)(),c=["id","date","amount","note"],u="expenses.docx"}let p=await o(d,c);t.setHeader("Content-Type","application/vnd.openxmlformats-officedocument.wordprocessingml.document"),t.setHeader("Content-Disposition",`attachment; filename="${u}"`),t.send(p)}[r]=l.then?(await l)():l,e.s(["default",()=>d]),a()}catch(e){a(e)}},!1),1042,e=>e.a(async(t,a)=>{try{var i=e.i(6747),n=e.i(9245),s=e.i(4898),r=e.i(2950),l=e.i(4035),o=e.i(7031),d=e.i(1927),c=e.i(6432),u=t([l]);[l]=u.then?(await u)():u;let f=(0,r.hoist)(l,"default"),w=(0,r.hoist)(l,"config"),h=new s.PagesAPIRouteModule({definition:{kind:n.RouteKind.PAGES_API,page:"/api/export_docx",pathname:"/api/export_docx",bundlePath:"",filename:""},userland:l,distDir:".next",relativeProjectDir:""});async function p(e,t,a){h.isDev&&(0,c.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let n="/api/export_docx";n=n.replace(/\/index$/,"")||"/";let s=await h.prepare(e,t,{srcPage:n});if(!s){t.statusCode=400,t.end("Bad Request"),null==a.waitUntil||a.waitUntil.call(a,Promise.resolve());return}let{query:r,params:l,prerenderManifest:u,routerServerContext:p}=s;try{let a=e.method||"GET",i=(0,o.getTracer)(),s=i.getActiveScopeSpan(),c=h.instrumentationOnRequestError.bind(h),f=async s=>h.render(e,t,{query:{...r,...l},params:l,allowedRevalidateHeaderKeys:[],multiZoneDraftMode:!1,trustHostHeader:!1,previewProps:u.preview,propagateError:!1,dev:h.isDev,page:"/api/export_docx",internalRevalidate:null==p?void 0:p.revalidate,onError:(...t)=>c(e,...t)}).finally(()=>{if(!s)return;s.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let e=i.getRootSpanAttributes();if(!e)return;if(e.get("next.span_type")!==d.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${e.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let r=e.get("next.route");if(r){let e=`${a} ${r}`;s.setAttributes({"next.route":r,"http.route":r,"next.span_name":e}),s.updateName(e)}else s.updateName(`${a} ${n}`)});s?await f(s):await i.withPropagatedContext(e.headers,()=>i.trace(d.BaseServerSpan.handleRequest,{spanName:`${a} ${n}`,kind:o.SpanKind.SERVER,attributes:{"http.method":a,"http.target":e.url}},f))}catch(e){if(h.isDev)throw e;(0,i.sendError)(t,500,"Internal Server Error")}finally{null==a.waitUntil||a.waitUntil.call(a,Promise.resolve())}}e.s(["config",0,w,"default",0,f,"handler",()=>p]),a()}catch(e){a(e)}},!1)];

//# sourceMappingURL=%5Broot-of-the-server%5D__d6be025b._.js.map