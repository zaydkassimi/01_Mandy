{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Zayd/Desktop/01_Mandy/lib/auth.js"],"sourcesContent":["import jwt from \"jsonwebtoken\";\r\nimport { serialize } from \"cookie\";\r\n\r\nconst JWT_SECRET = process.env.JWT_SECRET || \"dev-secret\";\r\n\r\nexport function signToken(payload) {\r\n  return jwt.sign(payload, JWT_SECRET, { expiresIn: \"8h\" });\r\n}\r\n\r\nexport function verifyToken(token) {\r\n  try {\r\n    return jwt.verify(token, JWT_SECRET);\r\n  } catch (e) {\r\n    return null;\r\n  }\r\n}\r\n\r\nexport function setTokenCookie(res, token) {\r\n  const cookie = serialize(\"token\", token, {\r\n    httpOnly: true,\r\n    path: \"/\",\r\n    maxAge: 60 * 60 * 8\r\n  });\r\n  res.setHeader(\"Set-Cookie\", cookie);\r\n}\r\n\r\nexport function clearTokenCookie(res) {\r\n  const cookie = serialize(\"token\", \"\", {\r\n    httpOnly: true,\r\n    path: \"/\",\r\n    maxAge: 0\r\n  });\r\n  res.setHeader(\"Set-Cookie\", cookie);\r\n}\r\n\r\n\r\n"],"names":[],"mappings":";;;;;;;;;;AAAA;AACA;;;AAEA,MAAM,aAAa,QAAQ,GAAG,CAAC,UAAU,IAAI;AAEtC,SAAS,UAAU,OAAO;IAC/B,OAAO,4HAAG,CAAC,IAAI,CAAC,SAAS,YAAY;QAAE,WAAW;IAAK;AACzD;AAEO,SAAS,YAAY,KAAK;IAC/B,IAAI;QACF,OAAO,4HAAG,CAAC,MAAM,CAAC,OAAO;IAC3B,EAAE,OAAO,GAAG;QACV,OAAO;IACT;AACF;AAEO,SAAS,eAAe,GAAG,EAAE,KAAK;IACvC,MAAM,SAAS,IAAA,kHAAS,EAAC,SAAS,OAAO;QACvC,UAAU;QACV,MAAM;QACN,QAAQ,KAAK,KAAK;IACpB;IACA,IAAI,SAAS,CAAC,cAAc;AAC9B;AAEO,SAAS,iBAAiB,GAAG;IAClC,MAAM,SAAS,IAAA,kHAAS,EAAC,SAAS,IAAI;QACpC,UAAU;QACV,MAAM;QACN,QAAQ;IACV;IACA,IAAI,SAAS,CAAC,cAAc;AAC9B"}},
    {"offset": {"line": 63, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Zayd/Desktop/01_Mandy/pages/admin/shifts.js"],"sourcesContent":["import { parse } from \"cookie\";\r\nimport { verifyToken } from \"../../lib/auth\";\r\nimport { useEffect, useState } from \"react\";\r\nimport { ToastContext } from \"../../components/ToastContext\";\r\nimport { useContext } from \"react\";\r\n\r\nexport default function AdminShifts({ user }) {\r\n  const [shifts, setShifts] = useState([]);\r\n  const [title, setTitle] = useState(\"\");\r\n  const [date, setDate] = useState(\"\");\r\n  const [start, setStart] = useState(\"\");\r\n  const [end, setEnd] = useState(\"\");\r\n  const [capacity, setCapacity] = useState(1);\r\n  const [availabilities, setAvailabilities] = useState([]);\r\n  const { showToast } = useContext(ToastContext);\r\n\r\n  useEffect(() => {\r\n    fetch(\"/api/admin/shifts\").then((r) => r.json()).then((d) => { if (d.ok) setShifts(d.shifts || []); });\r\n    fetch(\"/api/admin/availability\").then((r) => r.json()).then((d) => { if (d.ok) setAvailabilities(d.availabilities || []); });\r\n  }, []);\r\n\r\n  async function add() {\r\n    await fetch(\"/api/admin/shifts\", {\r\n      method: \"POST\",\r\n      headers: { \"Content-Type\": \"application/json\" },\r\n      body: JSON.stringify({ title, date, start, end, capacity })\r\n    });\r\n    setTitle(\"\"); setDate(\"\"); setStart(\"\"); setEnd(\"\"); setCapacity(1);\r\n    const res = await fetch(\"/api/admin/shifts\"); const j = await res.json();\r\n    if (j.ok) setShifts(j.shifts || []);\r\n  }\r\n\r\n  async function del(id) {\r\n    if (!confirm(\"Delete shift?\")) return;\r\n    await fetch(\"/api/admin/shifts\", { method: \"DELETE\", headers: { \"Content-Type\": \"application/json\" }, body: JSON.stringify({ id }) });\r\n    setShifts((s) => s.filter((sh) => sh.id !== id));\r\n  }\r\n\r\n  async function assignToShift(shiftId, email) {\r\n    if (!email) return alert(\"Choose a staff email\");\r\n    const res = await fetch(\"/api/admin/assign_shift\", {\r\n      method: \"POST\",\r\n      headers: { \"Content-Type\": \"application/json\" },\r\n      body: JSON.stringify({ shiftId, email })\r\n    });\r\n    const data = await res.json();\r\n    if (data.ok) {\r\n      showToast(\"Assigned\");\r\n      // refresh shifts\r\n      const res2 = await fetch(\"/api/admin/shifts\"); const j = await res2.json();\r\n      if (j.ok) setShifts(j.shifts || []);\r\n    } else {\r\n      showToast(\"Assign failed\", { type: \"error\" });\r\n    }\r\n  }\r\n\r\n  return (\r\n    <main>\r\n      <h1>Manage Shifts</h1>\r\n      <div className=\"card\">\r\n        <div>\r\n          <input placeholder=\"title\" value={title} onChange={(e) => setTitle(e.target.value)} /> <input type=\"date\" value={date} onChange={(e) => setDate(e.target.value)} />\r\n          <input type=\"time\" value={start} onChange={(e) => setStart(e.target.value)} style={{ marginLeft: 8 }} /> <input type=\"time\" value={end} onChange={(e) => setEnd(e.target.value)} style={{ marginLeft: 8 }} />\r\n          <input type=\"number\" value={capacity} onChange={(e) => setCapacity(Number(e.target.value))} style={{ width: 80, marginLeft: 8 }} />\r\n          <button className=\"btn\" onClick={add} style={{ marginLeft: 8 }}>Add Shift</button>\r\n        </div>\r\n        <table style={{ width: \"100%\", marginTop: 12 }}>\r\n          <thead><tr><th>Title</th><th>Date</th><th>Time</th><th>Cap</th><th>Action</th></tr></thead>\r\n          <tbody>\r\n            {shifts.map((s) => (\r\n              <tr key={s.id}>\r\n                <td style={{ padding: 8 }}>{s.title}</td>\r\n                <td style={{ padding: 8 }}>{s.date}</td>\r\n                <td style={{ padding: 8 }}>{s.start} - {s.end}</td>\r\n                <td style={{ padding: 8 }}>{s.capacity}</td>\r\n                <td style={{ padding: 8 }}>\r\n                  <button className=\"btn secondary\" onClick={() => del(s.id)}>Delete</button>\r\n                  <div style={{ marginTop: 8 }}>\r\n                    <select id={\"assign-\"+s.id} defaultValue=\"\">\r\n                      <option value=\"\">Assign staff</option>\r\n                      {availabilities.filter(a => a.date === s.date).map(a => <option key={a.email} value={a.email}>{a.email}</option>)}\r\n                    </select>\r\n                    <button className=\"btn\" style={{ marginLeft: 8 }} onClick={() => {\r\n                      const sel = document.getElementById(\"assign-\"+s.id);\r\n                      assignToShift(s.id, sel?.value);\r\n                    }}>Assign</button>\r\n                  </div>\r\n                </td>\r\n              </tr>\r\n            ))}\r\n          </tbody>\r\n        </table>\r\n      </div>\r\n    </main>\r\n  );\r\n}\r\n\r\nexport function getServerSideProps({ req }) {\r\n  const cookies = req.headers.cookie ? parse(req.headers.cookie || \"\") : {};\r\n  const token = cookies.token;\r\n  const user = token ? verifyToken(token) : null;\r\n  if (!user || user.role !== \"admin\") {\r\n    return { redirect: { destination: \"/\", permanent: false } };\r\n  }\r\n  return { props: { user } };\r\n}\r\n\r\n\r\n"],"names":[],"mappings":"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"}}]
}