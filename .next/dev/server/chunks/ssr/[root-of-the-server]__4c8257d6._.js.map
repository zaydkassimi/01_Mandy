{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Zayd/Desktop/01_Mandy/lib/auth.js"],"sourcesContent":["import jwt from \"jsonwebtoken\";\r\nimport { serialize } from \"cookie\";\r\n\r\nconst JWT_SECRET = process.env.JWT_SECRET || \"dev-secret\";\r\n\r\nexport function signToken(payload) {\r\n  return jwt.sign(payload, JWT_SECRET, { expiresIn: \"8h\" });\r\n}\r\n\r\nexport function verifyToken(token) {\r\n  try {\r\n    return jwt.verify(token, JWT_SECRET);\r\n  } catch (e) {\r\n    return null;\r\n  }\r\n}\r\n\r\nexport function setTokenCookie(res, token) {\r\n  const cookie = serialize(\"token\", token, {\r\n    httpOnly: true,\r\n    path: \"/\",\r\n    maxAge: 60 * 60 * 8\r\n  });\r\n  res.setHeader(\"Set-Cookie\", cookie);\r\n}\r\n\r\nexport function clearTokenCookie(res) {\r\n  const cookie = serialize(\"token\", \"\", {\r\n    httpOnly: true,\r\n    path: \"/\",\r\n    maxAge: 0\r\n  });\r\n  res.setHeader(\"Set-Cookie\", cookie);\r\n}\r\n\r\n\r\n"],"names":[],"mappings":";;;;;;;;;;AAAA;AACA;;;AAEA,MAAM,aAAa,QAAQ,GAAG,CAAC,UAAU,IAAI;AAEtC,SAAS,UAAU,OAAO;IAC/B,OAAO,4HAAG,CAAC,IAAI,CAAC,SAAS,YAAY;QAAE,WAAW;IAAK;AACzD;AAEO,SAAS,YAAY,KAAK;IAC/B,IAAI;QACF,OAAO,4HAAG,CAAC,MAAM,CAAC,OAAO;IAC3B,EAAE,OAAO,GAAG;QACV,OAAO;IACT;AACF;AAEO,SAAS,eAAe,GAAG,EAAE,KAAK;IACvC,MAAM,SAAS,IAAA,kHAAS,EAAC,SAAS,OAAO;QACvC,UAAU;QACV,MAAM;QACN,QAAQ,KAAK,KAAK;IACpB;IACA,IAAI,SAAS,CAAC,cAAc;AAC9B;AAEO,SAAS,iBAAiB,GAAG;IAClC,MAAM,SAAS,IAAA,kHAAS,EAAC,SAAS,IAAI;QACpC,UAAU;QACV,MAAM;QACN,QAAQ;IACV;IACA,IAAI,SAAS,CAAC,cAAc;AAC9B"}},
    {"offset": {"line": 63, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Zayd/Desktop/01_Mandy/pages/admin/attendance.js"],"sourcesContent":["import { parse } from \"cookie\";\r\nimport { verifyToken } from \"../../lib/auth\";\r\nimport { useEffect, useState } from \"react\";\r\n\r\nexport default function AdminAttendance({ user }) {\r\n  const [list, setList] = useState([]);\r\n\r\n  useEffect(() => {\r\n    fetch(\"/api/attendance?all=1\")\r\n      .then((r) => r.json())\r\n      .then((data) => {\r\n        if (data.ok) setList(data.attendances || []);\r\n      });\r\n  }, []);\r\n\r\n  async function approve(id, approve) {\r\n    await fetch(\"/api/attendance/approve\", {\r\n      method: \"POST\",\r\n      headers: { \"Content-Type\": \"application/json\" },\r\n      body: JSON.stringify({ id, approved: approve })\r\n    });\r\n    setList((s) => s.map((it) => (it.id === id ? { ...it, approved: approve } : it)));\r\n  }\r\n\r\n  return (\r\n    <main>\r\n      <h1>All Attendance</h1>\r\n      <div className=\"card\">\r\n        <p>Signed in as <strong>{user.email}</strong></p>\r\n        <table style={{ width: \"100%\", borderCollapse: \"collapse\" }}>\r\n          <thead>\r\n            <tr>\r\n              <th style={{ textAlign: \"left\", borderBottom: \"1px solid #e5e7eb\" }}>Email</th>\r\n              <th style={{ textAlign: \"left\", borderBottom: \"1px solid #e5e7eb\" }}>Action</th>\r\n              <th style={{ textAlign: \"left\", borderBottom: \"1px solid #e5e7eb\" }}>Time</th>\r\n              <th style={{ textAlign: \"left\", borderBottom: \"1px solid #e5e7eb\" }}>Geo</th>\r\n              <th style={{ textAlign: \"left\", borderBottom: \"1px solid #e5e7eb\" }}>Photo</th>\r\n              <th style={{ textAlign: \"left\", borderBottom: \"1px solid #e5e7eb\" }}>Approved</th>\r\n            </tr>\r\n          </thead>\r\n          <tbody>\r\n            {list.map((r) => (\r\n              <tr key={r.id}>\r\n                <td style={{ padding: 8, borderBottom: \"1px solid #f3f4f6\" }}>{r.email}</td>\r\n                <td style={{ padding: 8, borderBottom: \"1px solid #f3f4f6\" }}>{r.action}</td>\r\n                <td style={{ padding: 8, borderBottom: \"1px solid #f3f4f6\" }}>{new Date(r.timestamp).toLocaleString()}</td>\r\n                <td style={{ padding: 8, borderBottom: \"1px solid #f3f4f6\" }}>{r.lat ? `${r.lat.toFixed(4)}, ${r.lng.toFixed(4)}` : \"-\"}</td>\r\n                <td style={{ padding: 8, borderBottom: \"1px solid #f3f4f6\" }}>\r\n                  {r.photo ? <img src={r.photo} style={{ width: 80, borderRadius: 6 }} /> : \"-\"}\r\n                </td>\r\n                <td style={{ padding: 8, borderBottom: \"1px solid #f3f4f6\" }}>\r\n                  {r.approved ? \"Yes\" : \"No\"} {r.lateRequested ? \"(Late requested)\" : \"\"}\r\n                  <div style={{ marginTop: 6 }}>\r\n                    {!r.approved && <button className=\"btn\" onClick={() => approve(r.id, true)}>Approve</button>}\r\n                    {r.approved && <button className=\"btn secondary\" onClick={() => approve(r.id, false)}>Revoke</button>}\r\n                  </div>\r\n                </td>\r\n              </tr>\r\n            ))}\r\n          </tbody>\r\n        </table>\r\n      </div>\r\n    </main>\r\n  );\r\n}\r\n\r\nexport function getServerSideProps({ req }) {\r\n  const cookies = req.headers.cookie ? parse(req.headers.cookie || \"\") : {};\r\n  const token = cookies.token;\r\n  const user = token ? verifyToken(token) : null;\r\n  if (!user || user.role !== \"admin\") {\r\n    return { redirect: { destination: \"/\", permanent: false } };\r\n  }\r\n  return { props: { user } };\r\n}\r\n\r\n\r\n"],"names":[],"mappings":"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"}}]
}