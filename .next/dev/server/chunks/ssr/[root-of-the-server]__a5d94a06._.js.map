{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Zayd/Desktop/01_Mandy/lib/auth.js"],"sourcesContent":["import jwt from \"jsonwebtoken\";\r\nimport { serialize } from \"cookie\";\r\n\r\nconst JWT_SECRET = process.env.JWT_SECRET || \"dev-secret\";\r\n\r\nexport function signToken(payload) {\r\n  return jwt.sign(payload, JWT_SECRET, { expiresIn: \"8h\" });\r\n}\r\n\r\nexport function verifyToken(token) {\r\n  try {\r\n    return jwt.verify(token, JWT_SECRET);\r\n  } catch (e) {\r\n    return null;\r\n  }\r\n}\r\n\r\nexport function setTokenCookie(res, token) {\r\n  const cookie = serialize(\"token\", token, {\r\n    httpOnly: true,\r\n    path: \"/\",\r\n    maxAge: 60 * 60 * 8\r\n  });\r\n  res.setHeader(\"Set-Cookie\", cookie);\r\n}\r\n\r\nexport function clearTokenCookie(res) {\r\n  const cookie = serialize(\"token\", \"\", {\r\n    httpOnly: true,\r\n    path: \"/\",\r\n    maxAge: 0\r\n  });\r\n  res.setHeader(\"Set-Cookie\", cookie);\r\n}\r\n\r\n\r\n"],"names":[],"mappings":";;;;;;;;;;AAAA;AACA;;;AAEA,MAAM,aAAa,QAAQ,GAAG,CAAC,UAAU,IAAI;AAEtC,SAAS,UAAU,OAAO;IAC/B,OAAO,4HAAG,CAAC,IAAI,CAAC,SAAS,YAAY;QAAE,WAAW;IAAK;AACzD;AAEO,SAAS,YAAY,KAAK;IAC/B,IAAI;QACF,OAAO,4HAAG,CAAC,MAAM,CAAC,OAAO;IAC3B,EAAE,OAAO,GAAG;QACV,OAAO;IACT;AACF;AAEO,SAAS,eAAe,GAAG,EAAE,KAAK;IACvC,MAAM,SAAS,IAAA,kHAAS,EAAC,SAAS,OAAO;QACvC,UAAU;QACV,MAAM;QACN,QAAQ,KAAK,KAAK;IACpB;IACA,IAAI,SAAS,CAAC,cAAc;AAC9B;AAEO,SAAS,iBAAiB,GAAG;IAClC,MAAM,SAAS,IAAA,kHAAS,EAAC,SAAS,IAAI;QACpC,UAAU;QACV,MAAM;QACN,QAAQ;IACV;IACA,IAAI,SAAS,CAAC,cAAc;AAC9B"}},
    {"offset": {"line": 63, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Zayd/Desktop/01_Mandy/pages/calendar.js"],"sourcesContent":["import { useEffect, useState } from \"react\";\r\nimport { parse } from \"cookie\";\r\nimport { verifyToken } from \"../lib/auth\";\r\n\r\nfunction formatDateKey(d) {\r\n  const yyyy = d.getFullYear();\r\n  const mm = String(d.getMonth() + 1).padStart(2, \"0\");\r\n  const dd = String(d.getDate()).padStart(2, \"0\");\r\n  return `${yyyy}-${mm}-${dd}`;\r\n}\r\n\r\nexport default function CalendarPage({ user }) {\r\n  const [monthStart, setMonthStart] = useState(() => {\r\n    const d = new Date();\r\n    d.setDate(1);\r\n    return d;\r\n  });\r\n  const [availMap, setAvailMap] = useState({});\r\n\r\n  useEffect(() => {\r\n    fetch(\"/api/availability\")\r\n      .then((r) => r.json())\r\n      .then((data) => {\r\n        if (data.ok) {\r\n          const m = {};\r\n          for (const a of data.availabilities || []) {\r\n            m[a.date] = a.status;\r\n          }\r\n          setAvailMap(m);\r\n        }\r\n      });\r\n  }, []);\r\n\r\n  function daysInMonth(d) {\r\n    const year = d.getFullYear();\r\n    const month = d.getMonth();\r\n    return new Date(year, month + 1, 0).getDate();\r\n  }\r\n\r\n  function prevMonth() {\r\n    const d = new Date(monthStart);\r\n    d.setMonth(d.getMonth() - 1);\r\n    setMonthStart(d);\r\n  }\r\n  function nextMonth() {\r\n    const d = new Date(monthStart);\r\n    d.setMonth(d.getMonth() + 1);\r\n    setMonthStart(d);\r\n  }\r\n\r\n  async function toggleDate(day) {\r\n    const d = new Date(monthStart);\r\n    d.setDate(day);\r\n    const key = formatDateKey(d);\r\n    const current = availMap[key];\r\n    // cycle: undefined -> available -> unavailable -> undefined\r\n    const next = current === undefined ? \"available\" : current === \"available\" ? \"unavailable\" : undefined;\r\n    await fetch(\"/api/availability\", {\r\n      method: \"POST\",\r\n      headers: { \"Content-Type\": \"application/json\" },\r\n      body: JSON.stringify({ date: key, status: next })\r\n    });\r\n    setAvailMap((s) => {\r\n      const copy = { ...s };\r\n      if (next) copy[key] = next;\r\n      else delete copy[key];\r\n      return copy;\r\n    });\r\n  }\r\n\r\n  const year = monthStart.getFullYear();\r\n  const month = monthStart.getMonth();\r\n  const totalDays = daysInMonth(monthStart);\r\n  const firstWeekday = new Date(year, month, 1).getDay(); // 0-6 Sun-Sat\r\n\r\n  const blanks = Array.from({ length: firstWeekday }).map((_, i) => <div key={\"b\" + i} />);\r\n\r\n  const days = Array.from({ length: totalDays }).map((_, i) => {\r\n    const day = i + 1;\r\n    const d = new Date(year, month, day);\r\n    const key = formatDateKey(d);\r\n    const status = availMap[key];\r\n    const style = {\r\n      padding: 8,\r\n      borderRadius: 6,\r\n      cursor: \"pointer\",\r\n      background: status === \"available\" ? \"#d1fae5\" : status === \"unavailable\" ? \"#fee2e2\" : \"white\",\r\n      border: \"1px solid #e5e7eb\",\r\n      textAlign: \"center\"\r\n    };\r\n    return (\r\n      <div key={key} style={style} onClick={() => toggleDate(day)}>\r\n        <div style={{ fontSize: 12 }}>{day}</div>\r\n        <div style={{ fontSize: 11, color: \"#374151\" }}>{status === \"available\" ? \"Available\" : status === \"unavailable\" ? \"Unavailable\" : \"\"}</div>\r\n      </div>\r\n    );\r\n  });\r\n\r\n  return (\r\n    <main>\r\n      <h1>{user?.email}'s Availability Calendar</h1>\r\n      <div style={{ display: \"flex\", gap: 8, marginBottom: 12 }}>\r\n        <button className=\"btn secondary\" onClick={prevMonth}>Prev</button>\r\n        <div style={{ alignSelf: \"center\", fontWeight: 600 }}>{monthStart.toLocaleString(undefined, { month: \"long\", year: \"numeric\" })}</div>\r\n        <button className=\"btn\" onClick={nextMonth}>Next</button>\r\n      </div>\r\n      <div style={{ display: \"grid\", gridTemplateColumns: \"repeat(7,1fr)\", gap: 8 }}>\r\n        <div style={{ fontWeight: 600 }}>Sun</div><div style={{ fontWeight: 600 }}>Mon</div><div style={{ fontWeight: 600 }}>Tue</div><div style={{ fontWeight: 600 }}>Wed</div><div style={{ fontWeight: 600 }}>Thu</div><div style={{ fontWeight: 600 }}>Fri</div><div style={{ fontWeight: 600 }}>Sat</div>\r\n        {blanks}\r\n        {days}\r\n      </div>\r\n      <p style={{ marginTop: 12 }}><strong>How to use:</strong> Click a date to mark Available (green), click again to mark Unavailable (red), click again to clear.</p>\r\n    </main>\r\n  );\r\n}\r\n\r\nexport function getServerSideProps({ req }) {\r\n  const cookies = req.headers.cookie ? parse(req.headers.cookie || \"\") : {};\r\n  const token = cookies.token;\r\n  const user = token ? verifyToken(token) : null;\r\n  if (!user) {\r\n    return { redirect: { destination: \"/login\", permanent: false } };\r\n  }\r\n  return { props: { user } };\r\n}\r\n\r\n\r\n"],"names":[],"mappings":";;;;;;;AAAA;AACA;AACA;;;;;AAEA,SAAS,cAAc,CAAC;IACtB,MAAM,OAAO,EAAE,WAAW;IAC1B,MAAM,KAAK,OAAO,EAAE,QAAQ,KAAK,GAAG,QAAQ,CAAC,GAAG;IAChD,MAAM,KAAK,OAAO,EAAE,OAAO,IAAI,QAAQ,CAAC,GAAG;IAC3C,OAAO,GAAG,KAAK,CAAC,EAAE,GAAG,CAAC,EAAE,IAAI;AAC9B;AAEe,SAAS,aAAa,EAAE,IAAI,EAAE;IAC3C,MAAM,CAAC,YAAY,cAAc,GAAG,IAAA,+GAAQ,EAAC;QAC3C,MAAM,IAAI,IAAI;QACd,EAAE,OAAO,CAAC;QACV,OAAO;IACT;IACA,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,+GAAQ,EAAC,CAAC;IAE1C,IAAA,gHAAS,EAAC;QACR,MAAM,qBACH,IAAI,CAAC,CAAC,IAAM,EAAE,IAAI,IAClB,IAAI,CAAC,CAAC;YACL,IAAI,KAAK,EAAE,EAAE;gBACX,MAAM,IAAI,CAAC;gBACX,KAAK,MAAM,KAAK,KAAK,cAAc,IAAI,EAAE,CAAE;oBACzC,CAAC,CAAC,EAAE,IAAI,CAAC,GAAG,EAAE,MAAM;gBACtB;gBACA,YAAY;YACd;QACF;IACJ,GAAG,EAAE;IAEL,SAAS,YAAY,CAAC;QACpB,MAAM,OAAO,EAAE,WAAW;QAC1B,MAAM,QAAQ,EAAE,QAAQ;QACxB,OAAO,IAAI,KAAK,MAAM,QAAQ,GAAG,GAAG,OAAO;IAC7C;IAEA,SAAS;QACP,MAAM,IAAI,IAAI,KAAK;QACnB,EAAE,QAAQ,CAAC,EAAE,QAAQ,KAAK;QAC1B,cAAc;IAChB;IACA,SAAS;QACP,MAAM,IAAI,IAAI,KAAK;QACnB,EAAE,QAAQ,CAAC,EAAE,QAAQ,KAAK;QAC1B,cAAc;IAChB;IAEA,eAAe,WAAW,GAAG;QAC3B,MAAM,IAAI,IAAI,KAAK;QACnB,EAAE,OAAO,CAAC;QACV,MAAM,MAAM,cAAc;QAC1B,MAAM,UAAU,QAAQ,CAAC,IAAI;QAC7B,4DAA4D;QAC5D,MAAM,OAAO,YAAY,YAAY,cAAc,YAAY,cAAc,gBAAgB;QAC7F,MAAM,MAAM,qBAAqB;YAC/B,QAAQ;YACR,SAAS;gBAAE,gBAAgB;YAAmB;YAC9C,MAAM,KAAK,SAAS,CAAC;gBAAE,MAAM;gBAAK,QAAQ;YAAK;QACjD;QACA,YAAY,CAAC;YACX,MAAM,OAAO;gBAAE,GAAG,CAAC;YAAC;YACpB,IAAI,MAAM,IAAI,CAAC,IAAI,GAAG;iBACjB,OAAO,IAAI,CAAC,IAAI;YACrB,OAAO;QACT;IACF;IAEA,MAAM,OAAO,WAAW,WAAW;IACnC,MAAM,QAAQ,WAAW,QAAQ;IACjC,MAAM,YAAY,YAAY;IAC9B,MAAM,eAAe,IAAI,KAAK,MAAM,OAAO,GAAG,MAAM,IAAI,cAAc;IAEtE,MAAM,SAAS,MAAM,IAAI,CAAC;QAAE,QAAQ;IAAa,GAAG,GAAG,CAAC,CAAC,GAAG,kBAAM,qKAAC,WAAS,MAAM;;;;;IAElF,MAAM,OAAO,MAAM,IAAI,CAAC;QAAE,QAAQ;IAAU,GAAG,GAAG,CAAC,CAAC,GAAG;QACrD,MAAM,MAAM,IAAI;QAChB,MAAM,IAAI,IAAI,KAAK,MAAM,OAAO;QAChC,MAAM,MAAM,cAAc;QAC1B,MAAM,SAAS,QAAQ,CAAC,IAAI;QAC5B,MAAM,QAAQ;YACZ,SAAS;YACT,cAAc;YACd,QAAQ;YACR,YAAY,WAAW,cAAc,YAAY,WAAW,gBAAgB,YAAY;YACxF,QAAQ;YACR,WAAW;QACb;QACA,qBACE,qKAAC;YAAc,OAAO;YAAO,SAAS,IAAM,WAAW;;8BACrD,qKAAC;oBAAI,OAAO;wBAAE,UAAU;oBAAG;8BAAI;;;;;;8BAC/B,qKAAC;oBAAI,OAAO;wBAAE,UAAU;wBAAI,OAAO;oBAAU;8BAAI,WAAW,cAAc,cAAc,WAAW,gBAAgB,gBAAgB;;;;;;;WAF3H;;;;;IAKd;IAEA,qBACE,qKAAC;;0BACC,qKAAC;;oBAAI,MAAM;oBAAM;;;;;;;0BACjB,qKAAC;gBAAI,OAAO;oBAAE,SAAS;oBAAQ,KAAK;oBAAG,cAAc;gBAAG;;kCACtD,qKAAC;wBAAO,WAAU;wBAAgB,SAAS;kCAAW;;;;;;kCACtD,qKAAC;wBAAI,OAAO;4BAAE,WAAW;4BAAU,YAAY;wBAAI;kCAAI,WAAW,cAAc,CAAC,WAAW;4BAAE,OAAO;4BAAQ,MAAM;wBAAU;;;;;;kCAC7H,qKAAC;wBAAO,WAAU;wBAAM,SAAS;kCAAW;;;;;;;;;;;;0BAE9C,qKAAC;gBAAI,OAAO;oBAAE,SAAS;oBAAQ,qBAAqB;oBAAiB,KAAK;gBAAE;;kCAC1E,qKAAC;wBAAI,OAAO;4BAAE,YAAY;wBAAI;kCAAG;;;;;;kCAAS,qKAAC;wBAAI,OAAO;4BAAE,YAAY;wBAAI;kCAAG;;;;;;kCAAS,qKAAC;wBAAI,OAAO;4BAAE,YAAY;wBAAI;kCAAG;;;;;;kCAAS,qKAAC;wBAAI,OAAO;4BAAE,YAAY;wBAAI;kCAAG;;;;;;kCAAS,qKAAC;wBAAI,OAAO;4BAAE,YAAY;wBAAI;kCAAG;;;;;;kCAAS,qKAAC;wBAAI,OAAO;4BAAE,YAAY;wBAAI;kCAAG;;;;;;kCAAS,qKAAC;wBAAI,OAAO;4BAAE,YAAY;wBAAI;kCAAG;;;;;;oBAC5R;oBACA;;;;;;;0BAEH,qKAAC;gBAAE,OAAO;oBAAE,WAAW;gBAAG;;kCAAG,qKAAC;kCAAO;;;;;;oBAAoB;;;;;;;;;;;;;AAG/D;AAEO,SAAS,mBAAmB,EAAE,GAAG,EAAE;IACxC,MAAM,UAAU,IAAI,OAAO,CAAC,MAAM,GAAG,IAAA,8GAAK,EAAC,IAAI,OAAO,CAAC,MAAM,IAAI,MAAM,CAAC;IACxE,MAAM,QAAQ,QAAQ,KAAK;IAC3B,MAAM,OAAO,QAAQ,IAAA,mHAAW,EAAC,SAAS;IAC1C,IAAI,CAAC,MAAM;QACT,OAAO;YAAE,UAAU;gBAAE,aAAa;gBAAU,WAAW;YAAM;QAAE;IACjE;IACA,OAAO;QAAE,OAAO;YAAE;QAAK;IAAE;AAC3B"}}]
}