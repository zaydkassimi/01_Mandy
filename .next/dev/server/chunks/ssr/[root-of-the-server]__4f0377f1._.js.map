{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Zayd/Desktop/01_Mandy/lib/auth.js"],"sourcesContent":["import jwt from \"jsonwebtoken\";\r\nimport { serialize } from \"cookie\";\r\n\r\nconst JWT_SECRET = process.env.JWT_SECRET || \"dev-secret\";\r\n\r\nexport function signToken(payload) {\r\n  return jwt.sign(payload, JWT_SECRET, { expiresIn: \"8h\" });\r\n}\r\n\r\nexport function verifyToken(token) {\r\n  try {\r\n    return jwt.verify(token, JWT_SECRET);\r\n  } catch (e) {\r\n    return null;\r\n  }\r\n}\r\n\r\nexport function setTokenCookie(res, token) {\r\n  const cookie = serialize(\"token\", token, {\r\n    httpOnly: true,\r\n    path: \"/\",\r\n    maxAge: 60 * 60 * 8\r\n  });\r\n  res.setHeader(\"Set-Cookie\", cookie);\r\n}\r\n\r\nexport function clearTokenCookie(res) {\r\n  const cookie = serialize(\"token\", \"\", {\r\n    httpOnly: true,\r\n    path: \"/\",\r\n    maxAge: 0\r\n  });\r\n  res.setHeader(\"Set-Cookie\", cookie);\r\n}\r\n\r\n\r\n"],"names":[],"mappings":";;;;;;;;;;AAAA;AACA;;;AAEA,MAAM,aAAa,QAAQ,GAAG,CAAC,UAAU,IAAI;AAEtC,SAAS,UAAU,OAAO;IAC/B,OAAO,4HAAG,CAAC,IAAI,CAAC,SAAS,YAAY;QAAE,WAAW;IAAK;AACzD;AAEO,SAAS,YAAY,KAAK;IAC/B,IAAI;QACF,OAAO,4HAAG,CAAC,MAAM,CAAC,OAAO;IAC3B,EAAE,OAAO,GAAG;QACV,OAAO;IACT;AACF;AAEO,SAAS,eAAe,GAAG,EAAE,KAAK;IACvC,MAAM,SAAS,IAAA,kHAAS,EAAC,SAAS,OAAO;QACvC,UAAU;QACV,MAAM;QACN,QAAQ,KAAK,KAAK;IACpB;IACA,IAAI,SAAS,CAAC,cAAc;AAC9B;AAEO,SAAS,iBAAiB,GAAG;IAClC,MAAM,SAAS,IAAA,kHAAS,EAAC,SAAS,IAAI;QACpC,UAAU;QACV,MAAM;QACN,QAAQ;IACV;IACA,IAAI,SAAS,CAAC,cAAc;AAC9B"}},
    {"offset": {"line": 63, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Zayd/Desktop/01_Mandy/pages/admin/availability.js"],"sourcesContent":["import { parse } from \"cookie\";\r\nimport { verifyToken } from \"../../lib/auth\";\r\nimport { useEffect, useState } from \"react\";\r\nimport Card from \"../../components/ui/Card\";\r\nimport Button from \"../../components/ui/Button\";\r\nimport { useContext } from \"react\";\r\nimport { ToastContext } from \"../../components/ToastContext\";\r\n\r\nexport default function AdminAvailability({ user }) {\r\n  const [avail, setAvail] = useState([]);\r\n  const [shifts, setShifts] = useState([]);\r\n  const [loading, setLoading] = useState(false);\r\n  const [message, setMessage] = useState(\"\");\r\n  const [monthStart, setMonthStart] = useState(() => {\r\n    const d = new Date();\r\n    d.setDate(1);\r\n    return d;\r\n  });\r\n  const [selectedDate, setSelectedDate] = useState(null);\r\n  const [prevAvailCount, setPrevAvailCount] = useState(0);\r\n  const [newCount, setNewCount] = useState(0);\r\n\r\n  useEffect(() => {\r\n    fetchData();\r\n    const id = setInterval(fetchData, 10000);\r\n    return () => clearInterval(id);\r\n  }, []);\r\n\r\n  async function fetchData() {\r\n    const a = await fetch(\"/api/admin/availability\").then((r) => r.json());\r\n    const s = await fetch(\"/api/admin/shifts\").then((r) => r.json());\r\n    if (a.ok) {\r\n      const list = a.availabilities || [];\r\n      // calculate new items since last check\r\n      if (prevAvailCount > 0 && list.length > prevAvailCount) {\r\n        setNewCount(list.length - prevAvailCount);\r\n      }\r\n      setPrevAvailCount(list.length);\r\n      setAvail(list);\r\n    }\r\n    if (s.ok) setShifts(s.shifts || []);\r\n  }\r\n\r\n  const { showToast } = useContext(ToastContext);\r\n\r\n  async function assign(availability, shiftId) {\r\n    if (!shiftId) return alert(\"Choose a shift\");\r\n    setLoading(true);\r\n    const res = await fetch(\"/api/admin/assign_shift\", {\r\n      method: \"POST\",\r\n      headers: { \"Content-Type\": \"application/json\" },\r\n      body: JSON.stringify({ shiftId, email: availability.email })\r\n    });\r\n    const data = await res.json();\r\n    setLoading(false);\r\n    if (data.ok) {\r\n      showToast(`Assigned ${availability.email} to shift`, { type: \"info\" });\r\n      fetchData();\r\n    } else {\r\n      showToast(\"Assignment failed\", { type: \"error\" });\r\n    }\r\n  }\r\n\r\n  // group by date\r\n  const byDate = avail.reduce((acc, a) => {\r\n    acc[a.date] = acc[a.date] || [];\r\n    acc[a.date].push(a);\r\n    return acc;\r\n  }, {});\r\n\r\n  function formatDateKey(d) {\r\n    const yyyy = d.getFullYear();\r\n    const mm = String(d.getMonth() + 1).padStart(2, \"0\");\r\n    const dd = String(d.getDate()).padStart(2, \"0\");\r\n    return `${yyyy}-${mm}-${dd}`;\r\n  }\r\n\r\n  function daysInMonth(d) {\r\n    const year = d.getFullYear();\r\n    const month = d.getMonth();\r\n    return new Date(year, month + 1, 0).getDate();\r\n  }\r\n\r\n  function prevMonth() {\r\n    const d = new Date(monthStart);\r\n    d.setMonth(d.getMonth() - 1);\r\n    setMonthStart(d);\r\n    setSelectedDate(null);\r\n  }\r\n  function nextMonth() {\r\n    const d = new Date(monthStart);\r\n    d.setMonth(d.getMonth() + 1);\r\n    setMonthStart(d);\r\n    setSelectedDate(null);\r\n  }\r\n\r\n  return (\r\n    <main>\r\n      <h1>Staff Availability</h1>\r\n      <p className=\"small\">View staff availability and allocate shifts.</p>\r\n      {message && <div className=\"mt-3 p-3 rounded-md bg-green-50 text-green-800\">{message}</div>}\r\n      {newCount > 0 && <div className=\"mt-3\"><span className=\"text-sm bg-yellow-100 text-yellow-800 px-2 py-1 rounded\">New: {newCount}</span> <button className=\"ml-2 text-sm\" onClick={() => setNewCount(0)}>Clear</button></div>}\r\n\r\n      <div className=\"mt-4\">\r\n        <div className=\"flex items-center gap-4 mb-4\">\r\n          <Button onClick={prevMonth} variant=\"ghost\">Prev</Button>\r\n          <div className=\"font-semibold\">{monthStart.toLocaleString(undefined, { month: \"long\", year: \"numeric\" })}</div>\r\n          <Button onClick={nextMonth} variant=\"ghost\">Next</Button>\r\n        </div>\r\n\r\n        <div className=\"grid grid-cols-7 gap-3\">\r\n          {[\"Sun\",\"Mon\",\"Tue\",\"Wed\",\"Thu\",\"Fri\",\"Sat\"].map((d) => <div key={d} className=\"text-sm text-gray-500\">{d}</div>)}\r\n          {Array.from({ length: new Date(monthStart.getFullYear(), monthStart.getMonth(), 1).getDay() }).map((_, i) => <div key={\"b\"+i} />)}\r\n          {Array.from({ length: daysInMonth(monthStart) }).map((_, idx) => {\r\n            const day = idx + 1;\r\n            const d = new Date(monthStart.getFullYear(), monthStart.getMonth(), day);\r\n            const key = formatDateKey(d);\r\n            const items = byDate[key] || [];\r\n            const dayShifts = shifts.filter(s => s.date === key);\r\n            return (\r\n              <div key={key} className=\"p-3 border rounded-md bg-white\">\r\n                <div className=\"flex justify-between items-start\">\r\n                  <div className=\"text-sm font-medium\">{day}</div>\r\n                  <div className=\"text-xs text-gray-500\">{items.length} avail</div>\r\n                </div>\r\n                <div className=\"mt-2 text-sm space-y-1\">\r\n                  {items.slice(0,3).map(it => <div key={it.email} className=\"flex items-center justify-between\"><div>{it.email}</div></div>)}\r\n                  {items.length > 3 && <div className=\"text-xs text-gray-400\">+{items.length-3} more</div>}\r\n                </div>\r\n                <div className=\"mt-3\">\r\n                  <Button onClick={() => setSelectedDate(key)} variant=\"secondary\">Manage</Button>\r\n                </div>\r\n              </div>\r\n            );\r\n          })}\r\n        </div>\r\n\r\n        {selectedDate && (\r\n          <Card className=\"mt-6\">\r\n            <div className=\"flex items-center justify-between\">\r\n              <div>\r\n                <div className=\"text-sm text-gray-500\">Date</div>\r\n                <div className=\"font-semibold\">{selectedDate}</div>\r\n              </div>\r\n              <div>\r\n                <Button onClick={() => { setSelectedDate(null); }}>Close</Button>\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"mt-4\">\r\n              <div className=\"text-sm text-gray-600 mb-2\">Available staff</div>\r\n              {(byDate[selectedDate] || []).map((it) => (\r\n                <div key={it.email} className=\"flex items-center justify-between gap-3 mb-2\">\r\n                  <div>{it.email}</div>\r\n                  <div className=\"flex items-center gap-2\">\r\n                    <select defaultValue=\"\" className=\"border px-2 py-1 rounded-md\" id={`shift-select-${it.email}`}>\r\n                      <option value=\"\">Select shift</option>\r\n                      {shifts.filter(s => s.date === selectedDate).map((s) => (\r\n                        <option key={s.id} value={s.id}>{s.title} ({s.start || \"â€”\"})</option>\r\n                      ))}\r\n                    </select>\r\n                    <Button onClick={() => {\r\n                      const sel = document.getElementById(`shift-select-${it.email}`);\r\n                      assign(it, sel?.value);\r\n                    }} disabled={loading}>Assign</Button>\r\n                  </div>\r\n                </div>\r\n              ))}\r\n            </div>\r\n          </Card>\r\n        )}\r\n      </div>\r\n    </main>\r\n  );\r\n}\r\n\r\nexport function getServerSideProps({ req }) {\r\n  const cookies = req.headers.cookie ? parse(req.headers.cookie || \"\") : {};\r\n  const token = cookies.token;\r\n  const user = token ? verifyToken(token) : null;\r\n  if (!user || user.role !== \"admin\") {\r\n    return { redirect: { destination: \"/\", permanent: false } };\r\n  }\r\n  return { props: { user } };\r\n}\r\n\r\n\r\n"],"names":[],"mappings":"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"}}]
}