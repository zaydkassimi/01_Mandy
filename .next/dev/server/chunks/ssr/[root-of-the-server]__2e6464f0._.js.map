{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Zayd/Desktop/01_Mandy/lib/auth.js"],"sourcesContent":["import jwt from \"jsonwebtoken\";\r\nimport { serialize } from \"cookie\";\r\n\r\nconst JWT_SECRET = process.env.JWT_SECRET || \"dev-secret\";\r\n\r\nexport function signToken(payload) {\r\n  return jwt.sign(payload, JWT_SECRET, { expiresIn: \"8h\" });\r\n}\r\n\r\nexport function verifyToken(token) {\r\n  try {\r\n    return jwt.verify(token, JWT_SECRET);\r\n  } catch (e) {\r\n    return null;\r\n  }\r\n}\r\n\r\nexport function setTokenCookie(res, token) {\r\n  const cookie = serialize(\"token\", token, {\r\n    httpOnly: true,\r\n    path: \"/\",\r\n    maxAge: 60 * 60 * 8\r\n  });\r\n  res.setHeader(\"Set-Cookie\", cookie);\r\n}\r\n\r\nexport function clearTokenCookie(res) {\r\n  const cookie = serialize(\"token\", \"\", {\r\n    httpOnly: true,\r\n    path: \"/\",\r\n    maxAge: 0\r\n  });\r\n  res.setHeader(\"Set-Cookie\", cookie);\r\n}\r\n\r\n\r\n"],"names":[],"mappings":";;;;;;;;;;AAAA;AACA;;;AAEA,MAAM,aAAa,QAAQ,GAAG,CAAC,UAAU,IAAI;AAEtC,SAAS,UAAU,OAAO;IAC/B,OAAO,4HAAG,CAAC,IAAI,CAAC,SAAS,YAAY;QAAE,WAAW;IAAK;AACzD;AAEO,SAAS,YAAY,KAAK;IAC/B,IAAI;QACF,OAAO,4HAAG,CAAC,MAAM,CAAC,OAAO;IAC3B,EAAE,OAAO,GAAG;QACV,OAAO;IACT;AACF;AAEO,SAAS,eAAe,GAAG,EAAE,KAAK;IACvC,MAAM,SAAS,IAAA,kHAAS,EAAC,SAAS,OAAO;QACvC,UAAU;QACV,MAAM;QACN,QAAQ,KAAK,KAAK;IACpB;IACA,IAAI,SAAS,CAAC,cAAc;AAC9B;AAEO,SAAS,iBAAiB,GAAG;IAClC,MAAM,SAAS,IAAA,kHAAS,EAAC,SAAS,IAAI;QACpC,UAAU;QACV,MAAM;QACN,QAAQ;IACV;IACA,IAAI,SAAS,CAAC,cAAc;AAC9B"}},
    {"offset": {"line": 63, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Zayd/Desktop/01_Mandy/lib/format.js"],"sourcesContent":["export function formatGBP(value) {\r\n  const num = Number(value || 0);\r\n  return \"Â£\" + num.toFixed(2);\r\n}\r\n\r\n\r\n"],"names":[],"mappings":";;;;AAAO,SAAS,UAAU,KAAK;IAC7B,MAAM,MAAM,OAAO,SAAS;IAC5B,OAAO,MAAM,IAAI,OAAO,CAAC;AAC3B"}},
    {"offset": {"line": 75, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Zayd/Desktop/01_Mandy/pages/admin/expenses.js"],"sourcesContent":["import { parse } from \"cookie\";\r\nimport { verifyToken } from \"../../lib/auth\";\r\nimport { useEffect, useState } from \"react\";\r\nimport { formatGBP } from \"../../lib/format\";\r\nimport { useContext } from \"react\";\r\nimport { ToastContext } from \"../../components/ToastContext\";\r\n\r\nexport default function AdminExpenses({ user }) {\r\n  const [list, setList] = useState([]);\r\n  const [date, setDate] = useState(\"\");\r\n  const [amount, setAmount] = useState(\"\");\r\n  const [note, setNote] = useState(\"\");\r\n\r\n  useEffect(() => {\r\n    fetch(\"/api/admin/expenses\").then((r) => r.json()).then((d) => { if (d.ok) setList(d.expenses || []); });\r\n  }, []);\r\n\r\n  async function add() {\r\n    await fetch(\"/api/admin/expenses\", {\r\n      method: \"POST\",\r\n      headers: { \"Content-Type\": \"application/json\" },\r\n      body: JSON.stringify({ date, amount, note })\r\n    });\r\n    setDate(\"\"); setAmount(\"\"); setNote(\"\");\r\n    const res = await fetch(\"/api/admin/expenses\"); const j = await res.json();\r\n    if (j.ok) setList(j.expenses || []);\r\n  }\r\n\r\n  async function approve(id, approve) {\r\n    await fetch(\"/api/admin/expenses/approve\", {\r\n      method: \"POST\",\r\n      headers: { \"Content-Type\": \"application/json\" },\r\n      body: JSON.stringify({ id, approved: approve })\r\n    });\r\n    setList((s) => s.map((e) => (e.id === id ? { ...e, approved: approve } : e)));\r\n  }\r\n  const [message, setMessage] = useState(\"\");\r\n\r\n  async function approveWithMessage(id, approve) {\r\n    setMessage(\"\");\r\n    await fetch(\"/api/admin/expenses/approve\", {\r\n      method: \"POST\",\r\n      headers: { \"Content-Type\": \"application/json\" },\r\n      body: JSON.stringify({ id, approved: approve })\r\n    });\r\n    setList((s) => s.map((e) => (e.id === id ? { ...e, approved: approve } : e)));\r\n    const msg = approve ? \"Expense approved\" : \"Expense approval revoked\";\r\n    setMessage(msg);\r\n    showToast(msg, { type: approve ? \"info\" : \"info\" });\r\n    setTimeout(() => setMessage(\"\"), 3500);\r\n  }\r\n  const { showToast } = useContext(ToastContext);\r\n\r\n  return (\r\n    <main>\r\n      <h1>Expenses</h1>\r\n      <div className=\"card\">\r\n        <div>\r\n          <input type=\"date\" value={date} onChange={(e) => setDate(e.target.value)} /> <input placeholder=\"amount\" value={amount} onChange={(e) => setAmount(e.target.value)} />\r\n          <input placeholder=\"note\" value={note} onChange={(e) => setNote(e.target.value)} style={{ marginLeft: 8 }} />\r\n          <button className=\"btn\" onClick={add} style={{ marginLeft: 8 }}>Add</button>\r\n        </div>\r\n        <table style={{ width: \"100%\", marginTop: 12 }}>\r\n          <thead><tr><th>Date</th><th>Amount (GBP)</th><th>Note</th><th>By</th><th>Approved</th></tr></thead>\r\n          <tbody>\r\n            {list.map((e) => (\r\n              <tr key={e.id}>\r\n                <td style={{ padding: 8 }}>{e.date}</td>\r\n                <td style={{ padding: 8 }}>{formatGBP(e.amount)}</td>\r\n                <td style={{ padding: 8 }}>\r\n                  {e.note}\r\n                  {e.receipt && <div className=\"mt-2\"><a href={e.receipt} target=\"_blank\" rel=\"noreferrer\" className=\"text-sm text-blue-600\">View receipt</a></div>}\r\n                </td>\r\n                <td style={{ padding: 8 }}>{e.email}</td>\r\n                <td style={{ padding: 8 }}>\r\n                  {e.approved ? \"Yes\" : \"No\"}\r\n                  <div style={{ marginTop: 6 }}>\r\n                    {!e.approved && <button className=\"btn\" onClick={() => approveWithMessage(e.id, true)}>Approve</button>}\r\n                    {e.approved && <button className=\"btn secondary\" onClick={() => approveWithMessage(e.id, false)}>Revoke</button>}\r\n                  </div>\r\n                  {e.history && (\r\n                    <div style={{ marginTop: 8 }}>\r\n                      <div className=\"small\">History:</div>\r\n                      <ul className=\"text-xs text-gray-600\">\r\n                        {e.history.map((h, i) => <li key={i}>{h.ts}: {h.action}</li>)}\r\n                      </ul>\r\n                    </div>\r\n                  )}\r\n                </td>\r\n              </tr>\r\n            ))}\r\n          </tbody>\r\n        </table>\r\n        {message && <div className=\"mt-3 p-3 rounded-md bg-green-50 text-green-800\">{message}</div>}\r\n      </div>\r\n    </main>\r\n  );\r\n}\r\n\r\nexport function getServerSideProps({ req }) {\r\n  const cookies = req.headers.cookie ? parse(req.headers.cookie || \"\") : {};\r\n  const token = cookies.token;\r\n  const user = token ? verifyToken(token) : null;\r\n  if (!user || user.role !== \"admin\") {\r\n    return { redirect: { destination: \"/\", permanent: false } };\r\n  }\r\n  return { props: { user } };\r\n}\r\n\r\n\r\n"],"names":[],"mappings":";;;;;;;AAAA;AACA;AACA;AACA;AAEA;;;;;;;;AAEe,SAAS,cAAc,EAAE,IAAI,EAAE;IAC5C,MAAM,CAAC,MAAM,QAAQ,GAAG,IAAA,+GAAQ,EAAC,EAAE;IACnC,MAAM,CAAC,MAAM,QAAQ,GAAG,IAAA,+GAAQ,EAAC;IACjC,MAAM,CAAC,QAAQ,UAAU,GAAG,IAAA,+GAAQ,EAAC;IACrC,MAAM,CAAC,MAAM,QAAQ,GAAG,IAAA,+GAAQ,EAAC;IAEjC,IAAA,gHAAS,EAAC;QACR,MAAM,uBAAuB,IAAI,CAAC,CAAC,IAAM,EAAE,IAAI,IAAI,IAAI,CAAC,CAAC;YAAQ,IAAI,EAAE,EAAE,EAAE,QAAQ,EAAE,QAAQ,IAAI,EAAE;QAAG;IACxG,GAAG,EAAE;IAEL,eAAe;QACb,MAAM,MAAM,uBAAuB;YACjC,QAAQ;YACR,SAAS;gBAAE,gBAAgB;YAAmB;YAC9C,MAAM,KAAK,SAAS,CAAC;gBAAE;gBAAM;gBAAQ;YAAK;QAC5C;QACA,QAAQ;QAAK,UAAU;QAAK,QAAQ;QACpC,MAAM,MAAM,MAAM,MAAM;QAAwB,MAAM,IAAI,MAAM,IAAI,IAAI;QACxE,IAAI,EAAE,EAAE,EAAE,QAAQ,EAAE,QAAQ,IAAI,EAAE;IACpC;IAEA,eAAe,QAAQ,EAAE,EAAE,OAAO;QAChC,MAAM,MAAM,+BAA+B;YACzC,QAAQ;YACR,SAAS;gBAAE,gBAAgB;YAAmB;YAC9C,MAAM,KAAK,SAAS,CAAC;gBAAE;gBAAI,UAAU;YAAQ;QAC/C;QACA,QAAQ,CAAC,IAAM,EAAE,GAAG,CAAC,CAAC,IAAO,EAAE,EAAE,KAAK,KAAK;oBAAE,GAAG,CAAC;oBAAE,UAAU;gBAAQ,IAAI;IAC3E;IACA,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,+GAAQ,EAAC;IAEvC,eAAe,mBAAmB,EAAE,EAAE,OAAO;QAC3C,WAAW;QACX,MAAM,MAAM,+BAA+B;YACzC,QAAQ;YACR,SAAS;gBAAE,gBAAgB;YAAmB;YAC9C,MAAM,KAAK,SAAS,CAAC;gBAAE;gBAAI,UAAU;YAAQ;QAC/C;QACA,QAAQ,CAAC,IAAM,EAAE,GAAG,CAAC,CAAC,IAAO,EAAE,EAAE,KAAK,KAAK;oBAAE,GAAG,CAAC;oBAAE,UAAU;gBAAQ,IAAI;QACzE,MAAM,MAAM,UAAU,qBAAqB;QAC3C,WAAW;QACX,UAAU,KAAK;YAAE,MAAM,UAAU,SAAS;QAAO;QACjD,WAAW,IAAM,WAAW,KAAK;IACnC;IACA,MAAM,EAAE,SAAS,EAAE,GAAG,IAAA,iHAAU,EAAC,mIAAY;IAE7C,qBACE,qKAAC;;0BACC,qKAAC;0BAAG;;;;;;0BACJ,qKAAC;gBAAI,WAAU;;kCACb,qKAAC;;0CACC,qKAAC;gCAAM,MAAK;gCAAO,OAAO;gCAAM,UAAU,CAAC,IAAM,QAAQ,EAAE,MAAM,CAAC,KAAK;;;;;;4BAAK;0CAAC,qKAAC;gCAAM,aAAY;gCAAS,OAAO;gCAAQ,UAAU,CAAC,IAAM,UAAU,EAAE,MAAM,CAAC,KAAK;;;;;;0CACjK,qKAAC;gCAAM,aAAY;gCAAO,OAAO;gCAAM,UAAU,CAAC,IAAM,QAAQ,EAAE,MAAM,CAAC,KAAK;gCAAG,OAAO;oCAAE,YAAY;gCAAE;;;;;;0CACxG,qKAAC;gCAAO,WAAU;gCAAM,SAAS;gCAAK,OAAO;oCAAE,YAAY;gCAAE;0CAAG;;;;;;;;;;;;kCAElE,qKAAC;wBAAM,OAAO;4BAAE,OAAO;4BAAQ,WAAW;wBAAG;;0CAC3C,qKAAC;0CAAM,cAAA,qKAAC;;sDAAG,qKAAC;sDAAG;;;;;;sDAAS,qKAAC;sDAAG;;;;;;sDAAiB,qKAAC;sDAAG;;;;;;sDAAS,qKAAC;sDAAG;;;;;;sDAAO,qKAAC;sDAAG;;;;;;;;;;;;;;;;;0CACzE,qKAAC;0CACE,KAAK,GAAG,CAAC,CAAC,kBACT,qKAAC;;0DACC,qKAAC;gDAAG,OAAO;oDAAE,SAAS;gDAAE;0DAAI,EAAE,IAAI;;;;;;0DAClC,qKAAC;gDAAG,OAAO;oDAAE,SAAS;gDAAE;0DAAI,IAAA,mHAAS,EAAC,EAAE,MAAM;;;;;;0DAC9C,qKAAC;gDAAG,OAAO;oDAAE,SAAS;gDAAE;;oDACrB,EAAE,IAAI;oDACN,EAAE,OAAO,kBAAI,qKAAC;wDAAI,WAAU;kEAAO,cAAA,qKAAC;4DAAE,MAAM,EAAE,OAAO;4DAAE,QAAO;4DAAS,KAAI;4DAAa,WAAU;sEAAwB;;;;;;;;;;;;;;;;;0DAE7H,qKAAC;gDAAG,OAAO;oDAAE,SAAS;gDAAE;0DAAI,EAAE,KAAK;;;;;;0DACnC,qKAAC;gDAAG,OAAO;oDAAE,SAAS;gDAAE;;oDACrB,EAAE,QAAQ,GAAG,QAAQ;kEACtB,qKAAC;wDAAI,OAAO;4DAAE,WAAW;wDAAE;;4DACxB,CAAC,EAAE,QAAQ,kBAAI,qKAAC;gEAAO,WAAU;gEAAM,SAAS,IAAM,mBAAmB,EAAE,EAAE,EAAE;0EAAO;;;;;;4DACtF,EAAE,QAAQ,kBAAI,qKAAC;gEAAO,WAAU;gEAAgB,SAAS,IAAM,mBAAmB,EAAE,EAAE,EAAE;0EAAQ;;;;;;;;;;;;oDAElG,EAAE,OAAO,kBACR,qKAAC;wDAAI,OAAO;4DAAE,WAAW;wDAAE;;0EACzB,qKAAC;gEAAI,WAAU;0EAAQ;;;;;;0EACvB,qKAAC;gEAAG,WAAU;0EACX,EAAE,OAAO,CAAC,GAAG,CAAC,CAAC,GAAG,kBAAM,qKAAC;;4EAAY,EAAE,EAAE;4EAAC;4EAAG,EAAE,MAAM;;uEAApB;;;;;;;;;;;;;;;;;;;;;;;uCAlBnC,EAAE,EAAE;;;;;;;;;;;;;;;;oBA2BlB,yBAAW,qKAAC;wBAAI,WAAU;kCAAkD;;;;;;;;;;;;;;;;;;AAIrF;AAEO,SAAS,mBAAmB,EAAE,GAAG,EAAE;IACxC,MAAM,UAAU,IAAI,OAAO,CAAC,MAAM,GAAG,IAAA,8GAAK,EAAC,IAAI,OAAO,CAAC,MAAM,IAAI,MAAM,CAAC;IACxE,MAAM,QAAQ,QAAQ,KAAK;IAC3B,MAAM,OAAO,QAAQ,IAAA,mHAAW,EAAC,SAAS;IAC1C,IAAI,CAAC,QAAQ,KAAK,IAAI,KAAK,SAAS;QAClC,OAAO;YAAE,UAAU;gBAAE,aAAa;gBAAK,WAAW;YAAM;QAAE;IAC5D;IACA,OAAO;QAAE,OAAO;YAAE;QAAK;IAAE;AAC3B"}}]
}