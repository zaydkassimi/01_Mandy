{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Zayd/Desktop/01_Mandy/lib/auth.js"],"sourcesContent":["import jwt from \"jsonwebtoken\";\r\nimport { serialize } from \"cookie\";\r\n\r\nconst JWT_SECRET = process.env.JWT_SECRET || \"dev-secret\";\r\n\r\nexport function signToken(payload) {\r\n  return jwt.sign(payload, JWT_SECRET, { expiresIn: \"8h\" });\r\n}\r\n\r\nexport function verifyToken(token) {\r\n  try {\r\n    return jwt.verify(token, JWT_SECRET);\r\n  } catch (e) {\r\n    return null;\r\n  }\r\n}\r\n\r\nexport function setTokenCookie(res, token) {\r\n  const cookie = serialize(\"token\", token, {\r\n    httpOnly: true,\r\n    path: \"/\",\r\n    maxAge: 60 * 60 * 8\r\n  });\r\n  res.setHeader(\"Set-Cookie\", cookie);\r\n}\r\n\r\nexport function clearTokenCookie(res) {\r\n  const cookie = serialize(\"token\", \"\", {\r\n    httpOnly: true,\r\n    path: \"/\",\r\n    maxAge: 0\r\n  });\r\n  res.setHeader(\"Set-Cookie\", cookie);\r\n}\r\n\r\n\r\n"],"names":[],"mappings":";;;;;;;;;;AAAA;AACA;;;AAEA,MAAM,aAAa,QAAQ,GAAG,CAAC,UAAU,IAAI;AAEtC,SAAS,UAAU,OAAO;IAC/B,OAAO,4HAAG,CAAC,IAAI,CAAC,SAAS,YAAY;QAAE,WAAW;IAAK;AACzD;AAEO,SAAS,YAAY,KAAK;IAC/B,IAAI;QACF,OAAO,4HAAG,CAAC,MAAM,CAAC,OAAO;IAC3B,EAAE,OAAO,GAAG;QACV,OAAO;IACT;AACF;AAEO,SAAS,eAAe,GAAG,EAAE,KAAK;IACvC,MAAM,SAAS,IAAA,kHAAS,EAAC,SAAS,OAAO;QACvC,UAAU;QACV,MAAM;QACN,QAAQ,KAAK,KAAK;IACpB;IACA,IAAI,SAAS,CAAC,cAAc;AAC9B;AAEO,SAAS,iBAAiB,GAAG;IAClC,MAAM,SAAS,IAAA,kHAAS,EAAC,SAAS,IAAI;QACpC,UAAU;QACV,MAAM;QACN,QAAQ;IACV;IACA,IAAI,SAAS,CAAC,cAAc;AAC9B"}},
    {"offset": {"line": 63, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Zayd/Desktop/01_Mandy/pages/checkin.js"],"sourcesContent":["import { useEffect, useRef, useState } from \"react\";\r\nimport { parse } from \"cookie\";\r\nimport { verifyToken } from \"../lib/auth\";\r\n\r\nexport default function CheckInPage({ user }) {\r\n  const videoRef = useRef();\r\n  const canvasRef = useRef();\r\n  const [stream, setStream] = useState(null);\r\n  const [status, setStatus] = useState(\"\");\r\n\r\n  useEffect(() => {\r\n    let mounted = true;\r\n    async function start() {\r\n      try {\r\n        const s = await navigator.mediaDevices.getUserMedia({ video: { facingMode: { ideal: \"environment\" } }, audio: false });\r\n        if (!mounted) {\r\n          s.getTracks().forEach((t) => t.stop());\r\n          return;\r\n        }\r\n        setStream(s);\r\n        if (videoRef.current) videoRef.current.srcObject = s;\r\n      } catch (e) {\r\n        setStatus(\"Camera access denied or unavailable: \" + e.message);\r\n      }\r\n    }\r\n    start();\r\n    return () => {\r\n      mounted = false;\r\n      if (stream) {\r\n        stream.getTracks().forEach((t) => t.stop());\r\n      }\r\n    };\r\n  }, []);\r\n\r\n  function capturePhoto() {\r\n    const video = videoRef.current;\r\n    const canvas = canvasRef.current;\r\n    if (!video || !canvas) return null;\r\n    canvas.width = video.videoWidth || 640;\r\n    canvas.height = video.videoHeight || 480;\r\n    const ctx = canvas.getContext(\"2d\");\r\n    ctx.drawImage(video, 0, 0, canvas.width, canvas.height);\r\n    return canvas.toDataURL(\"image/jpeg\", 0.8);\r\n  }\r\n\r\n  function getGeo() {\r\n    return new Promise((resolve) => {\r\n      if (!navigator.geolocation) return resolve({ lat: null, lng: null });\r\n      navigator.geolocation.getCurrentPosition(\r\n        (pos) => resolve({ lat: pos.coords.latitude, lng: pos.coords.longitude }),\r\n        () => resolve({ lat: null, lng: null }),\r\n        { enableHighAccuracy: true, timeout: 5000, maximumAge: 0 }\r\n      );\r\n    });\r\n  }\r\n\r\n  async function submit(action) {\r\n    setStatus(\"Preparing...\");\r\n    const photo = capturePhoto();\r\n    if (!photo) {\r\n      setStatus(\"Unable to capture photo. Make sure camera is allowed and visible.\");\r\n      return;\r\n    }\r\n    const geo = await getGeo();\r\n    const now = new Date();\r\n    const isLate = now.getHours() > 9 || (now.getHours() === 9 && now.getMinutes() > 15);\r\n    let lateRequested = false;\r\n    if (isLate) {\r\n      lateRequested = confirm(\"It looks like you are late. Do you want to request admin approval?\");\r\n    }\r\n    setStatus(\"Uploading...\");\r\n    const res = await fetch(\"/api/attendance\", {\r\n      method: \"POST\",\r\n      headers: { \"Content-Type\": \"application/json\" },\r\n      body: JSON.stringify({\r\n        action,\r\n        photo,\r\n        lat: geo.lat,\r\n        lng: geo.lng,\r\n        clientTimestamp: now.toISOString(),\r\n        lateRequested\r\n      })\r\n    });\r\n    const data = await res.json();\r\n    if (data.ok) {\r\n      setStatus(`Success: ${action} recorded at ${new Date(data.attendance.timestamp).toLocaleString()}`);\r\n    } else {\r\n      setStatus(\"Error: \" + (data.message || \"Upload failed\"));\r\n    }\r\n  }\r\n\r\n  return (\r\n    <main>\r\n      <h1>Check In / Check Out</h1>\r\n      <div className=\"card\">\r\n        <p>Signed in as <strong>{user.email}</strong></p>\r\n        <div>\r\n          <video ref={videoRef} autoPlay playsInline style={{ width: \"100%\", maxWidth: 480, borderRadius: 8, background: \"#000\" }} />\r\n          <canvas ref={canvasRef} style={{ display: \"none\" }} />\r\n        </div>\r\n        <div style={{ marginTop: 12 }}>\r\n          <button className=\"btn\" onClick={() => submit(\"checkin\")}>Check In</button>\r\n          <button className=\"btn secondary\" onClick={() => submit(\"checkout\")} style={{ marginLeft: 8 }}>Check Out</button>\r\n        </div>\r\n        <div style={{ marginTop: 12 }}>{status}</div>\r\n      </div>\r\n    </main>\r\n  );\r\n}\r\n\r\nexport function getServerSideProps({ req }) {\r\n  const cookies = req.headers.cookie ? parse(req.headers.cookie || \"\") : {};\r\n  const token = cookies.token;\r\n  const user = token ? verifyToken(token) : null;\r\n  if (!user) {\r\n    return { redirect: { destination: \"/login\", permanent: false } };\r\n  }\r\n  if (user.role === \"admin\") {\r\n    return { redirect: { destination: \"/admin\", permanent: false } };\r\n  }\r\n  return { props: { user } };\r\n}\r\n\r\n\r\n"],"names":[],"mappings":"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"}}]
}